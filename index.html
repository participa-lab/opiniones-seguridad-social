<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="_next/static/css/d1386df84e9d164b.css" as="style" /><link rel="stylesheet" href="_next/static/css/d1386df84e9d164b.css"  data-n-g=""/><noscript data-n-css=""></noscript><script defer=""  nomodule="" src="_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="_next/static/chunks/webpack-1e7d36e3ced660e3.js" defer="" ></script><script src="_next/static/chunks/framework-0c7baedefba6b077.js" defer="" ></script><script src="_next/static/chunks/main-75623049b75f64cc.js" defer="" ></script><script src="_next/static/chunks/pages/_app-41fcb505e2a6ec3b.js" defer="" ></script><script src="_next/static/chunks/3e199aef-8a882f67d84a9743.js" defer="" ></script><script src="_next/static/chunks/413-fe7ad88e9897fb6d.js" defer="" ></script><script src="_next/static/chunks/664-4ccc24e47970c0fa.js" defer="" ></script><script src="_next/static/chunks/550-b94767e9a8d2895c.js" defer="" ></script><script src="_next/static/chunks/pages/index-cc72100c2afe033d.js" defer="" ></script><script src="_next/static/JlzSBEfWXFpqht8WQyym9/_buildManifest.js" defer="" ></script><script src="_next/static/JlzSBEfWXFpqht8WQyym9/_ssgManifest.js" defer="" ></script></head><body><div id="__next"></div><script id="__NEXT_DATA__" type="application/json" crossorigin="true">{"props":{"pageProps":{"result":{"clusters":[{"cluster":"Críticas a la Reforma de Seguridad Social","cluster_id":"1","takeaways":"Los participantes expresaron preocupaciones sobre la reforma de la Seguridad Social y el plebiscito propuesto. Muchos consideran que el plebiscito no aborda de manera integral la reforma y que podría generar más problemas, como un aumento en las demandas contra el estado. También se destacó la necesidad de un consenso y una solución más justa, ya que la reforma actual se percibe como injusta y perjudicial para los trabajadores.\n\nAlgunos argumentaron que el plebiscito es una oportunidad para informar a la ciudadanía y refleja un compromiso democrático, aunque otros cuestionaron su efectividad y la inclusión de temas en la constitución. En general, hay un llamado a una discusión más profunda y técnica sobre la reforma, en lugar de decisiones apresuradas que podrían tener consecuencias negativas a largo plazo.","arguments":[{"arg_id":"A127_0","argument":"El SI no considera aspectos técnicos indispensables para reformar la Seguridad Social.","comment_id":"127","x":10.425319,"y":10.680568,"p":0.6689514954795468},{"arg_id":"A15_1","argument":"Sin embargo, estos principios plantean dificultades jurídicas y económicas.","comment_id":"15","x":10.36799,"y":13.009068,"p":0},{"arg_id":"A201_0","argument":"La reforma 2023 mejora la situación de las personas con discapacidad.","comment_id":"201","x":11.369113,"y":11.723891,"p":0.8268965858819146},{"arg_id":"A14_0","argument":"El plebiscito propone restablecer derechos perdidos en la última regulación sobre la seguridad social.","comment_id":"14","x":10.103588,"y":11.482958,"p":1},{"arg_id":"A32_0","argument":"La reforma previsional de 2023 es más justa que el régimen anterior.","comment_id":"32","x":11.354176,"y":11.392051,"p":1},{"arg_id":"A32_1","argument":"La reforma previsional de 2023 soluciona los principales problemas.","comment_id":"32","x":11.241975,"y":11.622818,"p":1},{"arg_id":"A50_0","argument":"Los plebiscitos son actos que permiten mayor independencia de los ciudadanos respecto a sus partidos políticos.","comment_id":"50","x":9.036297,"y":11.979828,"p":1},{"arg_id":"A50_1","argument":"Dar libertad de acción en plebiscitos es una forma de respetar la voluntad ciudadana.","comment_id":"50","x":8.959872,"y":12.143977,"p":1},{"arg_id":"A174_0","argument":"Los partidos deben tomar una posición clara sobre temas importantes si tienen un programa.","comment_id":"174","x":9.233907,"y":12.780145,"p":0},{"arg_id":"A174_1","argument":"No es serio permitir libertad de acción en cuestiones cruciales.","comment_id":"174","x":9.287674,"y":12.664508,"p":0},{"arg_id":"A35_1","argument":"El 90% de las personas ha cobrado un promedio de $5,000.","comment_id":"35","x":10.758713,"y":11.686851,"p":1},{"arg_id":"A100_0","argument":"El plebiscito no aborda una reforma integral de la seguridad social, solo se enfoca en una parte de la reforma jubilatoria.","comment_id":"100","x":10.190323,"y":11.034846,"p":0},{"arg_id":"A52_0","argument":"Es difícil aprobar una reforma constitucional que deja demasiados puntos en una zona gris.","comment_id":"52","x":9.861173,"y":12.868243,"p":1},{"arg_id":"A33_0","argument":"Los mayores problemas sociales no se dan en las personas mayores, donde la pobreza es inferior al 2%.","comment_id":"33","x":10.78881,"y":10.829433,"p":0.7657636889264035},{"arg_id":"A76_0","argument":"Las acusaciones de inviabilidad de la reforma pueden basarse en supuestos económicos ortodoxos que deben ser revisados.","comment_id":"76","x":10.470858,"y":13.113628,"p":0},{"arg_id":"A230_0","argument":"El plebiscito consolida privilegios de algunos grupos, como la imposibilidad de revisar las inequidades de la Caja Militar.","comment_id":"230","x":9.378857,"y":11.613217,"p":0.3392909656762636},{"arg_id":"A62_0","argument":"La reforma de la seguridad recientemente aprobada castiga a los trabajadores.","comment_id":"62","x":11.925082,"y":10.957845,"p":1},{"arg_id":"A73_0","argument":"La reforma busca igualar las prestaciones de todas las cajas.","comment_id":"73","x":11.50138,"y":11.242407,"p":1},{"arg_id":"A73_1","argument":"La reforma es ley y puede ser modificada en cualquier momento.","comment_id":"73","x":10.207488,"y":12.078977,"p":1},{"arg_id":"A185_1","argument":"Si se deroga esta reforma, se crearán problemas mayores para el país.","comment_id":"185","x":10.608116,"y":12.466856,"p":0.7485152992912847},{"arg_id":"A155_1","argument":"Esto resultará en un millón de demandas contra el estado.","comment_id":"155","x":10.686334,"y":12.498275,"p":1},{"arg_id":"A72_0","argument":"Deberíamos encontrar una solución consensuada entre quienes discrepamos con la reforma actual.","comment_id":"72","x":11.251108,"y":13.294863,"p":0},{"arg_id":"A72_1","argument":"El plebiscito no refleja ese consenso.","comment_id":"72","x":9.030817,"y":11.432246,"p":1},{"arg_id":"A85_1","argument":"Este plebiscito es una oportunidad para informar a la ciudadanía.","comment_id":"85","x":9.077156,"y":12.003119,"p":1},{"arg_id":"A227_0","argument":"El plebiscito es una mala respuesta a una reforma del gobierno inadecuada.","comment_id":"227","x":9.01122,"y":11.544411,"p":1},{"arg_id":"A0_1","argument":"La regulación actual no resuelve los problemas de seguridad social.","comment_id":"0","x":10.552484,"y":10.790966,"p":1},{"arg_id":"A83_0","argument":"Economistas del FA y Coalición coinciden en que si se implementa esta medida, el país perderá en todos los aspectos.","comment_id":"83","x":10.877341,"y":12.642631,"p":0.8433128311342154},{"arg_id":"A108_0","argument":"No estoy de acuerdo con incluir estos temas en la constitución.","comment_id":"108","x":9.664283,"y":13.03379,"p":0.8151801700685847},{"arg_id":"A13_0","argument":"El plebiscito propone el cobro del salario mínimo por prestación social.","comment_id":"13","x":10.036895,"y":11.6931305,"p":1},{"arg_id":"A101_1","argument":"Cualquier ley es perfectible, incluyendo la revisión de la Caja Militar.","comment_id":"101","x":10.191377,"y":12.065131,"p":1},{"arg_id":"A2_0","argument":"La reforma de la seguridad social del gobierno es injusta.","comment_id":"2","x":11.664872,"y":10.906114,"p":1},{"arg_id":"A2_1","argument":"La reforma de la seguridad social no soluciona los principales problemas.","comment_id":"2","x":10.612733,"y":10.8805685,"p":1},{"arg_id":"A75_0","argument":"Estoy de acuerdo con una reforma previsional sin exoneraciones patronales.","comment_id":"75","x":11.688887,"y":11.476226,"p":0.7958539350782085},{"arg_id":"A79_0","argument":"El plebiscito presenta problemas de implementación, pero se plantea desde una perspectiva de justicia social.","comment_id":"79","x":9.573531,"y":11.95246,"p":0.2946921008903836},{"arg_id":"A79_1","argument":"El plebiscito es un punto de partida importante.","comment_id":"79","x":9.040567,"y":12.245878,"p":1},{"arg_id":"A142_0","argument":"No estoy seguro de que el plebiscito sea la solución.","comment_id":"142","x":9.040489,"y":11.5487175,"p":1},{"arg_id":"A142_1","argument":"La última reforma es mala, al igual que la que creó las AFPs.","comment_id":"142","x":11.515411,"y":10.742092,"p":0.7579925001033394},{"arg_id":"A48_0","argument":"Una reforma en la caja previsional es diferente de una reforma jubilatoria.","comment_id":"48","x":11.10928,"y":11.320953,"p":1},{"arg_id":"A48_1","argument":"Estamos más lejos de una reforma jubilatoria.","comment_id":"48","x":11.05252,"y":11.130516,"p":0.6879876332053467},{"arg_id":"A34_0","argument":"El plebiscito no ignora problemas como la pobreza infantil; al contrario, los fondos de la AFAP que se destinen al BPS permitirán atenderlos mejor.","comment_id":"34","x":9.736055,"y":11.241658,"p":0.3346606281688658},{"arg_id":"A89_0","argument":"Esta reforma, al igual que la del 96, obliga a la clase trabajadora a apretarse exclusivamente.","comment_id":"89","x":11.700759,"y":11.053476,"p":1},{"arg_id":"A173_0","argument":"La reforma tiene un efecto regresivo intra y transgeneracional.","comment_id":"173","x":10.765917,"y":11.912876,"p":1},{"arg_id":"A132_0","argument":"La reforma no solucionó todos los problemas, pero derogarla tampoco será la solución.","comment_id":"132","x":10.141727,"y":11.593803,"p":1},{"arg_id":"A38_0","argument":"La reforma propuesta en el plebiscito podría hacer perder el grado inversor de Uruguay.","comment_id":"38","x":10.165298,"y":12.45751,"p":0},{"arg_id":"A38_1","argument":"Esto generaría más dificultades para financiar el desarrollo del país.","comment_id":"38","x":10.771999,"y":12.6811075,"p":1},{"arg_id":"A124_0","argument":"El plebiscito no considera los cambios en el mercado laboral.","comment_id":"124","x":9.1077795,"y":11.29115,"p":0.7271731030206844},{"arg_id":"A124_1","argument":"El plebiscito no toma en cuenta la baja natalidad, lo que resulta en menos personas aportando.","comment_id":"124","x":9.146606,"y":11.114636,"p":0.6466548121512349},{"arg_id":"A206_0","argument":"El costo de cualquier reforma previsional es multimillonario.","comment_id":"206","x":10.821745,"y":11.645948,"p":1},{"arg_id":"A160_0","argument":"Aunque no es correcto incluirla en la Constitución, la reforma en sí es mucho más dañina.","comment_id":"160","x":9.967484,"y":12.717328,"p":0.5653050186840565},{"arg_id":"A17_0","argument":"No se puede incluir una propuesta como esta en la constitución debido a las dudas sobre su implementación.","comment_id":"17","x":9.752391,"y":12.991794,"p":1},{"arg_id":"A17_1","argument":"Es difícil cambiar propuestas constitucionales, por lo que estos temas deberían ser regulados por ley.","comment_id":"17","x":9.889709,"y":13.05534,"p":0.9753819237137458},{"arg_id":"A90_0","argument":"El plebiscito no soluciona todos los problemas.","comment_id":"90","x":9.240807,"y":11.366218,"p":0.5924331924701794},{"arg_id":"A97_0","argument":"Esta reforma es una medida socialista que busca soluciones temporales en lugar de sostenibles.","comment_id":"97","x":10.598518,"y":11.251277,"p":0},{"arg_id":"A66_0","argument":"El plebiscito no resuelve los problemas de las cajas militares, policiales y otros sistemas profesionales.","comment_id":"66","x":9.225231,"y":11.169559,"p":0.6913288112365138},{"arg_id":"A66_1","argument":"Ningún gobierno ha resuelto estos problemas en 30 años.","comment_id":"66","x":9.54728,"y":11.001956,"p":0.4496956977127747},{"arg_id":"A18_0","argument":"La constitución siempre tiene interpretaciones, y los cambios propuestos en el plebiscito no son la excepción.","comment_id":"18","x":9.486601,"y":12.435441,"p":0},{"arg_id":"A18_1","argument":"Incluir los cambios del plebiscito obliga a abrir debates a futuro.","comment_id":"18","x":9.063083,"y":12.335452,"p":0.8324203160872362},{"arg_id":"A113_0","argument":"Las leyes se reforman mediante otras leyes.","comment_id":"113","x":10.427545,"y":12.035826,"p":1},{"arg_id":"A113_1","argument":"No debemos incluir elementos difíciles de modificar en las reformas.","comment_id":"113","x":10.006668,"y":13.22508,"p":0.5349539221996806},{"arg_id":"A69_0","argument":"La iniciativa del plebiscito refleja un alto nivel de compromiso democrático y social, considerando el asunto como un tema de derechos humanos.","comment_id":"69","x":9.19877,"y":12.082222,"p":0.9428343653988844},{"arg_id":"A57_0","argument":"El plebiscito no resuelve el déficit del Estado relacionado con la caja militar y policial.","comment_id":"57","x":9.315861,"y":11.030038,"p":0.617654876376408},{"arg_id":"A57_1","argument":"El plebiscito no aborda problemas de otros sistemas corporativos, como las cajas profesionales.","comment_id":"57","x":9.388485,"y":11.207693,"p":0.6089435767314999}]},{"cluster":"Perspectivas de Justicia Social en la Seguridad Social","cluster_id":"0","takeaways":"Los participantes expresaron preocupaciones sobre la jubilación, destacando la necesidad de un enfoque más flexible y equitativo. Se propuso establecer la jubilación a los 60 años, pero se advirtió que esto podría no ser viable debido al aumento de la esperanza de vida y la precariedad laboral, especialmente para mujeres y trabajadores con menos aportes.\n\nSe sugirió que la jubilación debería depender de los aportes realizados y no solo de la edad. Además, se planteó la necesidad de políticas públicas que incentiven a la clase media a tener hijos y se abogó por un sistema de seguridad social que incluya a todos. La discusión sobre la jubilación debe ser integral, considerando la diversidad de sectores laborales y la importancia de gravar capitales para la sostenibilidad del sistema.","arguments":[{"arg_id":"A133_0","argument":"Los hombres tienen una media de 6 años menos de esperanza de vida y deberían jubilarse antes.","comment_id":"133","x":15.041273,"y":12.60835,"p":0.5820097157581221},{"arg_id":"A133_1","argument":"Es urgente considerar la perspectiva de género, ya que muchos hombres mueren pronto.","comment_id":"133","x":14.844905,"y":12.99687,"p":0.6998970362708345},{"arg_id":"A81_0","argument":"No se solucionará nada sin mejorar el acceso al mercado laboral para los jóvenes.","comment_id":"81","x":12.929184,"y":12.632726,"p":0.9041062423484146},{"arg_id":"A15_0","argument":"Estoy de acuerdo con los principios del plebiscito: 60 años para la jubilación, salario mínimo para las jubilaciones más bajas y eliminación del ahorro individual.","comment_id":"15","x":14.661561,"y":12.712694,"p":1},{"arg_id":"A201_1","argument":"Es necesario profundizar en las mejoras para las personas con discapacidad.","comment_id":"201","x":13.064127,"y":13.644807,"p":0.9735254565565944},{"arg_id":"A36_0","argument":"A los 60 años, la jubilación no garantiza acceso, especialmente para las personas precarizadas y las mujeres, que a menudo no alcanzan los 30 años de aportes.","comment_id":"36","x":15.249851,"y":12.171302,"p":0.6016661695553405},{"arg_id":"A9_1","argument":"El ahorro individual permite mayores posibilidades a las futuras generaciones.","comment_id":"9","x":13.829269,"y":11.133905,"p":1},{"arg_id":"A12_0","argument":"Es necesario asegurar un salario mínimo para las personas jubiladas o pensionistas.","comment_id":"12","x":14.057536,"y":12.359402,"p":1},{"arg_id":"A39_0","argument":"Establecer la edad jubilatoria a los 60 años en la Constitución es contrario a la evidencia sobre el aumento de la esperanza de vida.","comment_id":"39","x":15.096303,"y":12.4103775,"p":0.5700130226032741},{"arg_id":"A64_0","argument":"Todos queremos trabajar menos y ganar más, pero la longevidad plantea desafíos para pagar jubilaciones y seguro médico.","comment_id":"64","x":14.678664,"y":12.789451,"p":1},{"arg_id":"A64_1","argument":"La única solución parece ser aumentar los impuestos.","comment_id":"64","x":13.236502,"y":11.684815,"p":1},{"arg_id":"A65_0","argument":"La nueva reforma debe incluir un componente de redistribución de la riqueza de grandes capitales que a menudo están exentos de impuestos.","comment_id":"65","x":13.24063,"y":12.162403,"p":0.904576121687443},{"arg_id":"A22_0","argument":"No quiero escuchar ni apoyar propuestas que aumenten los impuestos a las personas trabajadoras.","comment_id":"22","x":13.0047245,"y":11.124588,"p":1},{"arg_id":"A103_0","argument":"Es necesario incentivar a la clase media a tener hijos mediante políticas públicas.","comment_id":"103","x":13.297652,"y":13.262665,"p":0.7816298946129049},{"arg_id":"A103_1","argument":"Se deben implementar exoneraciones tributarias para apoyar a la clase media en la crianza de hijos a largo plazo.","comment_id":"103","x":13.415529,"y":12.734257,"p":0.5421825008443},{"arg_id":"A115_0","argument":"Es necesario asegurar una pensión o jubilación acorde a los costos de vida del país.","comment_id":"115","x":14.095128,"y":12.516649,"p":1},{"arg_id":"A115_1","argument":"Las personas deben tener acceso a su medicación y a una mejor calidad de vida.","comment_id":"115","x":13.536747,"y":13.618847,"p":0},{"arg_id":"A94_0","argument":"Una persona de 65 años que cuida a sus nietos contribuye más a la seguridad social que si trabajara para aumentar el capital de empresarios millonarios.","comment_id":"94","x":12.72113,"y":12.147705,"p":0.8346988930368155},{"arg_id":"A24_0","argument":"El límite de 60 años beneficia a la Caja militar, notarial, bancaria y profesional, lo cual no es justo.","comment_id":"24","x":15.552621,"y":12.506593,"p":0},{"arg_id":"A59_0","argument":"Se necesita una propuesta que incluya a todos los sectores sociales para abordar el problema.","comment_id":"59","x":12.288983,"y":13.395286,"p":0},{"arg_id":"A33_1","argument":"Para lograr cambios significativos en este tema, es necesario complementar las políticas con cuidados y sanitarias.","comment_id":"33","x":12.85299,"y":13.470776,"p":1},{"arg_id":"A146_0","argument":"La esperanza de vida varía según el quintil de la población.","comment_id":"146","x":14.720539,"y":13.0627575,"p":0.6514616838531876},{"arg_id":"A146_1","argument":"Es necesario legislar específicamente para cada sector etáreo.","comment_id":"146","x":12.673321,"y":13.343419,"p":0},{"arg_id":"A78_0","argument":"Debería considerarse un sistema de protección social, ya que esta perspectiva es más integral y no está incluida en el plebiscito ni en la reforma actual.","comment_id":"78","x":12.003935,"y":12.716824,"p":1},{"arg_id":"A43_0","argument":"En sociedades envejecidas, es conveniente que parte de la jubilación provenga del ahorro previo individual.","comment_id":"43","x":14.221277,"y":11.48708,"p":0},{"arg_id":"A229_0","argument":"Atar la jubilación mínima al SMN definido por el gobierno es contraproducente.","comment_id":"229","x":14.36118,"y":11.782249,"p":0.6767526062403292},{"arg_id":"A229_1","argument":"Esto podría resultar en jubilaciones y salarios sumergidos.","comment_id":"229","x":14.197237,"y":12.378224,"p":1},{"arg_id":"A74_0","argument":"Si se realiza el plebiscito, es necesario discutir y reglamentar la seguridad social para todos.","comment_id":"74","x":12.051789,"y":13.033174,"p":0},{"arg_id":"A74_1","argument":"La seguridad social es una forma de distribuir mejor la riqueza.","comment_id":"74","x":12.580322,"y":12.288034,"p":1},{"arg_id":"A62_1","argument":"Se debe consensuar una salida que involucre a todos los afectados.","comment_id":"62","x":11.802758,"y":13.470453,"p":0},{"arg_id":"A185_0","argument":"La edad por sector es aceptable.","comment_id":"185","x":15.048596,"y":11.990363,"p":1},{"arg_id":"A80_0","argument":"Poner la responsabilidad de la sostenibilidad del sistema en los trabajadores aumenta las desigualdades.","comment_id":"80","x":12.528596,"y":11.496094,"p":1},{"arg_id":"A80_1","argument":"Es necesario gravar los capitales para promover la sostenibilidad.","comment_id":"80","x":13.164292,"y":12.927987,"p":0},{"arg_id":"A107_0","argument":"Es hora de legislar para que las contribuciones de los que más ganan sean mayores.","comment_id":"107","x":13.459907,"y":11.9166565,"p":1},{"arg_id":"A107_1","argument":"Las jubilaciones deben beneficiar a la clase trabajadora.","comment_id":"107","x":14.167409,"y":12.157427,"p":0.7720297918594807},{"arg_id":"A84_0","argument":"El aumento de la esperanza de vida no debe implicar un aumento en la edad de jubilación.","comment_id":"84","x":14.869366,"y":12.070527,"p":0.8293255584304795},{"arg_id":"A84_1","argument":"El aumento de la esperanza de vida también conlleva un aumento en la productividad y la automatización.","comment_id":"84","x":14.262141,"y":13.191578,"p":0},{"arg_id":"A158_0","argument":"La suba de impuestos siempre es enemiga de la prosperidad de los trabajadores.","comment_id":"158","x":12.889509,"y":11.145937,"p":0.9191275925198864},{"arg_id":"A23_0","argument":"Atar las prestaciones sociales al salario mínimo nacional frena su aumento para contener el costo de la seguridad social.","comment_id":"23","x":12.683309,"y":11.868513,"p":0},{"arg_id":"A23_1","argument":"Este riesgo afecta negativamente a las personas trabajadoras.","comment_id":"23","x":12.349964,"y":11.162593,"p":1},{"arg_id":"A88_0","argument":"Las personas deben beneficiarse de los incrementos de productividad.","comment_id":"88","x":13.638224,"y":13.274881,"p":0},{"arg_id":"A88_1","argument":"Existen diferencias de esperanza de vida según trabajos y clase.","comment_id":"88","x":14.710512,"y":12.845592,"p":1},{"arg_id":"A200_0","argument":"A los 60 años, cumplimos nuestro ciclo laboral, pero quienes deseen seguir trabajando deberían tener esa opción.","comment_id":"200","x":15.34544,"y":12.799606,"p":1},{"arg_id":"A11_0","argument":"Es necesario asegurar la posibilidad de jubilarse a los 60 años.","comment_id":"11","x":15.235753,"y":12.751955,"p":1},{"arg_id":"A11_1","argument":"La jubilación a los 60 años es un derecho.","comment_id":"11","x":15.463681,"y":12.594862,"p":0.5058076073391596},{"arg_id":"A7_0","argument":"La seguridad social es un tema intergeneracional que requiere sacrificios ahora para evitar problemas difíciles para las futuras generaciones.","comment_id":"7","x":12.68106,"y":12.710785,"p":1},{"arg_id":"A0_0","argument":"La seguridad social es un tema importante que debemos incluir en la agenda.","comment_id":"0","x":12.322279,"y":12.859837,"p":0},{"arg_id":"A13_1","argument":"Si una persona recibe más de una prestación, le corresponde el salario mínimo por cada una, lo que puede generar injusticias.","comment_id":"13","x":14.052089,"y":11.866577,"p":0.5497702632088087},{"arg_id":"A95_0","argument":"La aceleración digital está cambiando el paradigma y es necesario diseñar nuevos escenarios de vida desvinculados del trabajo.","comment_id":"95","x":14.177044,"y":13.289016,"p":0},{"arg_id":"A101_0","argument":"Se debe realizar un debate profundo entre políticos, académicos y la sociedad civil sobre las leyes relacionadas con la inteligencia artificial.","comment_id":"101","x":12.534933,"y":13.708581,"p":0},{"arg_id":"A99_0","argument":"La jubilación debe depender de los aportes realizados, no solo de la edad o necesidades.","comment_id":"99","x":14.704767,"y":11.726562,"p":0},{"arg_id":"A99_1","argument":"Quien no aportó no debe cobrar jubilación.","comment_id":"99","x":14.178535,"y":11.942539,"p":0.7720297918594807},{"arg_id":"A98_0","argument":"Si no ponemos un freno, pronto querrán que nos jubilemos a los 70.","comment_id":"98","x":15.287125,"y":12.83105,"p":1},{"arg_id":"A75_1","argument":"Apoyo la implementación de una renta básica universal por edad avanzada y crianza.","comment_id":"75","x":13.647637,"y":12.942009,"p":0.5456558329190083},{"arg_id":"A142_2","argument":"No se puede lucrar con la seguridad social.","comment_id":"142","x":12.025063,"y":11.776391,"p":0},{"arg_id":"A168_0","argument":"Los trabajadores a veces se ven obligados a trabajar en negro.","comment_id":"168","x":12.352224,"y":11.047091,"p":0},{"arg_id":"A168_1","argument":"Depender solo de los aportes realizados ignora esta realidad.","comment_id":"168","x":12.573804,"y":10.692609,"p":0},{"arg_id":"A37_0","argument":"La administración del sistema de seguridad social debe ser eficiente y de bajo costo.","comment_id":"37","x":12.420005,"y":12.445193,"p":1},{"arg_id":"A173_1","argument":"Es necesario enfocar los recursos del estado en la infancia y adolescencia.","comment_id":"173","x":13.056021,"y":13.374773,"p":1},{"arg_id":"A42_0","argument":"En una población envejecida, con mayor esperanza de vida y menos nacimientos, será difícil pagar jubilaciones dignas sin aumentar la edad de jubilación.","comment_id":"42","x":14.7238245,"y":12.422615,"p":0},{"arg_id":"A206_1","argument":"La cuestión fundamental es: ¿quién lo paga?","comment_id":"206","x":13.574203,"y":12.16238,"p":0.8931346747530698},{"arg_id":"A114_0","argument":"Los impuestos no son enemigos; una buena administración los utiliza para el bien común.","comment_id":"114","x":13.14549,"y":11.344784,"p":1},{"arg_id":"A114_1","argument":"Prefiero altos impuestos si se traducen en altas ganancias.","comment_id":"114","x":13.195575,"y":11.437355,"p":1},{"arg_id":"A10_0","argument":"La edad de jubilación debe estar relacionada con el tipo de trabajo que realizan las personas.","comment_id":"10","x":14.708755,"y":12.129408,"p":0},{"arg_id":"A157_0","argument":"Es necesario abordar el tema de las jubilaciones, ya que el sistema anterior ya no es viable con el actual porcentaje de activos y pasivos.","comment_id":"157","x":13.963214,"y":12.670621,"p":0.8483773427276893},{"arg_id":"A19_0","argument":"Se propone aumentar la edad de jubilación a 65 años, pero muchos trabajadores no pueden acceder o permanecer en el mercado laboral hasta esa edad.","comment_id":"19","x":15.270959,"y":12.167699,"p":0},{"arg_id":"A90_1","argument":"Es necesario establecer un diálogo social para abordar otros temas, como se hizo en 2008.","comment_id":"90","x":12.124421,"y":13.303311,"p":0},{"arg_id":"A176_0","argument":"Es necesario discutir y repensar cómo garantizar una jubilación que evite la pobreza en la vejez.","comment_id":"176","x":13.787449,"y":12.659472,"p":0.5456558329190083},{"arg_id":"A126_0","argument":"La edad mínima para ocupar cargos públicos, incluidos legisladores y presidentes, debería ser de 60 años.","comment_id":"126","x":15.209959,"y":12.586728,"p":0.703199727425947},{"arg_id":"A61_0","argument":"La edad de jubilación debe considerar el sector laboral, ya que no es lo mismo trabajar en construcción que en una oficina.","comment_id":"61","x":14.934372,"y":11.874317,"p":1},{"arg_id":"A6_0","argument":"Es necesario crear un sistema de seguridad social sin fines de lucro.","comment_id":"6","x":12.1259575,"y":12.497913,"p":1},{"arg_id":"A53_0","argument":"El ahorro o nivel de ingresos de las personas aumenta su capacidad de contribuir con impuestos para solucionar problemas sociales.","comment_id":"53","x":13.444429,"y":11.494757,"p":1},{"arg_id":"A193_0","argument":"Las jubilaciones y pensiones no deberían ser menores que el salario mínimo, ya que este es lo mínimo necesario para vivir.","comment_id":"193","x":14.392324,"y":12.034505,"p":0.6767526062403292},{"arg_id":"A44_0","argument":"La edad de jubilación no debe establecerse en la Constitución.","comment_id":"44","x":15.026156,"y":11.85173,"p":1},{"arg_id":"A96_0","argument":"El sistema de seguridad social es un modelo Ponzi.","comment_id":"96","x":12.125146,"y":12.116204,"p":0},{"arg_id":"A96_1","argument":"Debería ser opcional aportar al sistema de seguridad social.","comment_id":"96","x":12.007803,"y":12.552713,"p":1},{"arg_id":"A96_2","argument":"Cada persona debería ser libre de ahorrar o invertir a su manera.","comment_id":"96","x":13.958137,"y":11.017928,"p":1},{"arg_id":"A41_0","argument":"La financiación de la seguridad social se puede lograr con políticas que combatan la precarización laboral.","comment_id":"41","x":12.643462,"y":12.518485,"p":1},{"arg_id":"A41_1","argument":"Es necesario favorecer el ingreso de las nuevas generaciones al mercado de trabajo para financiar la seguridad social.","comment_id":"41","x":12.91114,"y":12.668596,"p":1},{"arg_id":"A93_0","argument":"La riqueza de la sociedad la construyen los trabajadores.","comment_id":"93","x":13.194756,"y":11.979801,"p":1},{"arg_id":"A93_1","argument":"Es injusto hacer trabajar 5 años más y cobrar menos.","comment_id":"93","x":14.536934,"y":11.384513,"p":0},{"arg_id":"A93_2","argument":"Deberíamos gravar el capital.","comment_id":"93","x":13.064599,"y":12.9203825,"p":0.7975487720618027}]},{"cluster":"Críticas a las AFAP","cluster_id":"2","takeaways":"Los participantes expresaron un fuerte rechazo hacia las AFAP, argumentando que su eliminación no implica perder el ahorro individual, que debería ser gestionado por el BPS sin comisiones. Se destacó que las pensiones bajas de los jubilados se deben a aportes insuficientes y que las AFAP son ineficaces debido a sus altas comisiones y bajos pagos. \n\nAdemás, se mencionó la necesidad de regular las IA y se criticó la inversión de las AFAP en tecnología que reduce el empleo. En general, se abogó por la eliminación de las AFAP para mejorar las jubilaciones y aumentar la recaudación del BPS, así como por la libertad de no ser obligado a afiliarse a una AFAP.","arguments":[{"arg_id":"A9_0","argument":"Eliminar las AFAP no significa eliminar el ahorro individual.","comment_id":"9","x":14.067741,"y":10.112067,"p":1},{"arg_id":"A210_0","argument":"El ahorro individual debe ser administrado por el BPS sin retener dinero por comisión.","comment_id":"210","x":13.918458,"y":10.780229,"p":1},{"arg_id":"A210_1","argument":"Se debe oponerse a las Afaps.","comment_id":"210","x":13.980265,"y":9.725626,"p":1},{"arg_id":"A226_0","argument":"Los jubilados de la AFAP reciben pensiones bajas porque aportaron por poco tiempo.","comment_id":"226","x":14.515552,"y":10.5055065,"p":0.5575075310749159},{"arg_id":"A226_1","argument":"Las AFAP son efectivas cuando se ahorra durante toda la vida laboral.","comment_id":"226","x":14.469279,"y":10.371529,"p":0.8335164003641443},{"arg_id":"A55_0","argument":"Es necesario eliminar las Afap, ya que no tienen ningún sentido.","comment_id":"55","x":14.0806265,"y":9.561106,"p":1},{"arg_id":"A35_0","argument":"Se deben eliminar las AFAP debido a sus altas comisiones y bajos pagos.","comment_id":"35","x":14.17858,"y":9.677464,"p":1},{"arg_id":"A43_1","argument":"Las AFAP son una de las formas de administrar el ahorro para la jubilación.","comment_id":"43","x":14.314396,"y":10.137992,"p":1},{"arg_id":"A183_0","argument":"Se deben regular las IA, ya que representan mano de obra que no aporta.","comment_id":"183","x":14.277004,"y":9.741913,"p":1},{"arg_id":"A155_0","argument":"La confiscación de los ahorros individuales por AFAP es una apropiación indebida.","comment_id":"155","x":14.029137,"y":10.027668,"p":0.9753918978110938},{"arg_id":"A191_0","argument":"Las AFAP invierten en cajeros automáticos, lo que reduce el empleo para los trabajadores.","comment_id":"191","x":14.3940735,"y":9.9184265,"p":1},{"arg_id":"A85_0","argument":"Hay desinformación sobre la seguridad social y las AFAP.","comment_id":"85","x":13.673542,"y":9.978391,"p":0.6506410518178743},{"arg_id":"A145_0","argument":"La eliminación de las AFAP mejoraría las jubilaciones.","comment_id":"145","x":14.198501,"y":10.196963,"p":1},{"arg_id":"A145_1","argument":"La eliminación de las AFAP aumentaría la recaudación del BPS.","comment_id":"145","x":13.958595,"y":10.328991,"p":0.8529771819754101},{"arg_id":"A108_1","argument":"No quiero ser obligado a afiliarme a una AFAP.","comment_id":"108","x":13.829355,"y":9.685003,"p":0.8337309916343065}]}],"comments":{"0":{"comment":"La seguridad social es un tema importante que debemos tener en agenda y que no está solucionado con la regulación actual.","agrees":350,"disagrees":29,"interview":"ParticipaLab","timestamp":1727011721981},"2":{"comment":"La reforma de la seguridad social del gobierno es injusta y no soluciona los principales problemas.","agrees":340,"disagrees":105,"interview":"ParticipaLab","timestamp":1727011767325},"6":{"comment":"Es necesario generar un sistema de seguridad social donde no esté incluido el lucro.","agrees":331,"disagrees":64,"interview":"ParticipaLab","timestamp":1727011799013},"7":{"comment":"La seguridad social es un tema intergeneracional, es necesario apretarnos un poco ahora y no dejar un problema difícil de solucionar para las futuras generaciones.","agrees":191,"disagrees":153,"interview":"ParticipaLab","timestamp":1727011805712},"9":{"comment":"Eliminar las AFAP no significa eliminar el ahorro individual. El ahorro individual permite mayores posibilidades a las futuras generaciones.","agrees":151,"disagrees":114,"interview":"ParticipaLab","timestamp":1727011833851},"10":{"comment":"La edad para jubilarse tiene que estar relacionado con el trabajo que las personas realizan.","agrees":318,"disagrees":96,"interview":"ParticipaLab","timestamp":1727011840516},"11":{"comment":"Es necesario y un derecho asegurar la posibilidad de jubilarse a los 60 años.","agrees":284,"disagrees":149,"interview":"ParticipaLab","timestamp":1727011853041},"12":{"comment":"Es necesario asegurar un salario mínimo para las personas jubiladas o pensionistas.","agrees":372,"disagrees":50,"interview":"ParticipaLab","timestamp":1727011861086},"13":{"comment":"El plebiscito plantea el cobro del salario mínimo por prestación social. Si una persona cobra más de una prestación, le corresponde por cada una. Eso puede traer injusticias.","agrees":152,"disagrees":124,"interview":"ParticipaLab","timestamp":1727011869850},"14":{"comment":"El plebiscito es una propuesta que restablece derechos perdidos en la última regulación sobre la seguridad social.","agrees":234,"disagrees":157,"interview":"ParticipaLab","timestamp":1727011882814},"15":{"comment":"Estoy de acuerdo con los principios fundamentales que plantea el plebiscito (60 años para la jubilación, salario mínimo para las jubilaciones más bajas, eliminación del ahorro individual) pero plantea dificultades jurídicas y económicas.","agrees":266,"disagrees":163,"interview":"ParticipaLab","timestamp":1727011894952},"17":{"comment":"No se puede incluir una propuesta como la de este plebiscito en la constitución. Deja muchas dudas de cómo implementarla, después es difícil de cambiar. Son temas que hay que regular por ley.","agrees":255,"disagrees":181,"interview":"ParticipaLab","timestamp":1727011913961},"18":{"comment":"La constitución siempre tiene interpretaciones, incluir los cambios que propone el plebiscito no es la excepción y obliga a abrir debates a futuro.","agrees":259,"disagrees":116,"interview":"ParticipaLab","timestamp":1727011934897},"19":{"comment":"Se plantea como una solución la suba a los 65 años, pero se olvida que para muchos trabajadores resulta imposible acceder o permanecer en el campo laboral hasta esa edad.","agrees":335,"disagrees":62,"interview":"ParticipaLab","timestamp":1727011944371},"22":{"comment":"Yo no quiero ni escuchar y menos apoyar una propuesta que haga pagar más impuestos a las personas trabajadoras.","agrees":184,"disagrees":117,"interview":"ParticipaLab","timestamp":1727011989316},"23":{"comment":"Cuando las prestaciones sociales estuvieron atadas al salario mínimo nacional se frenó su aumento para contener el costo de la seguridad social. Ese riesgo no lo quiero tener, afecta a las personas trabajadoras.","agrees":159,"disagrees":122,"interview":"ParticipaLab","timestamp":1727011997823},"24":{"comment":"El límite de los 60 años también beneficia a la Caja militar, notarial, bancaria y profesional. Me parece que no es justo.","agrees":113,"disagrees":151,"interview":"ParticipaLab","timestamp":1727012018169},"32":{"comment":"La reforma previsional de 2023 es más justa que el régimen anterior y soluciona los principales problemas.","agrees":49,"disagrees":201,"interview":"ParticipaLab","timestamp":1727694974904},"33":{"comment":"Los mayores problemas sociales no se dan en las personas mayores, entre las que la pobreza alcanza a menos del 2%. Para lograr cambios significativos en este tema hay que complementarlos con políticas de cuidados y sanitarias, entre otras.","agrees":261,"disagrees":46,"interview":"ParticipaLab","timestamp":1727695008502},"34":{"comment":"El plebiscito no desconoce problemas como la pobreza infantil; al contrario, podrán atenderse mejor con los fondos de la AFAP que se vuelquen al BPS","agrees":163,"disagrees":148,"interview":"ParticipaLab","timestamp":1727695049396},"35":{"comment":"Hay que eliminar las AFAP. Cobran altas comisiones y al final se cobra poco. El 90 % de la gente ha cobrado un promedio de $ 5.000.","agrees":237,"disagrees":117,"interview":"ParticipaLab","timestamp":1727695121203},"36":{"comment":"Regular a los 60 años la jubilación no significa que las personas puedan acceder a ella; los más precarizados y especialmente las mujeres es difícil que alcancen los 30 de años de aportes a esa edad.","agrees":272,"disagrees":72,"interview":"ParticipaLab","timestamp":1727695201549},"37":{"comment":"La administración del sistema de seguridad social se debe hacer de manera eficiente, con el menor costo posible.","agrees":248,"disagrees":70,"interview":"ParticipaLab","timestamp":1727695288189},"38":{"comment":"La reforma propuesta en el plebiscito hará perder el grado inversor de Uruguay y habrá más dificultades para financiar el desarrollo del país.","agrees":115,"disagrees":203,"interview":"ParticipaLab","timestamp":1727695299028},"39":{"comment":"Establecer la edad jubilatoria a los 60 años en la Constitución es contrario a toda la evidencia sobre el aumento de la esperanza de vida","agrees":159,"disagrees":215,"interview":"ParticipaLab","timestamp":1727695371534},"41":{"comment":"La financiación de la seguridad social se puede lograr con políticas en contra de la precarización laboral y que favorezcan el ingreso de las nuevas generaciones al mercado de trabajo.","agrees":306,"disagrees":60,"interview":"ParticipaLab","timestamp":1727778930244},"42":{"comment":"En una población cada vez más envejecida, porque se vive más tiempo y hay menos nacimientos, no habrá forma que se pueda pagar jubilaciones dignas sin subir la edad de jubilación.","agrees":166,"disagrees":240,"interview":"ParticipaLab","timestamp":1727778937847},"43":{"comment":"En sociedades envejecidas es conveniente que una parte de la jubilación provenga del ahorro previo individual. Las AFAP son una de varias formas de administrarlo","agrees":164,"disagrees":206,"interview":"ParticipaLab","timestamp":1727778946085},"44":{"comment":"La edad de jubilación no debe fijarse en la Constitución","agrees":207,"disagrees":128,"interview":"Monica (1959) (F)","timestamp":1727828412206},"48":{"comment":"Considero que una cosa es una reforma en la caja previsional y otra cuestión es una reforma jubilatoria. De lo segundo estamos más lejos.","agrees":121,"disagrees":36,"interview":"Morales (1989) (M)","timestamp":1727834712896},"50":{"comment":"los plebiscitos son los actos de mayor independencia de los ciudadanos de sus partidos políticos.Dar libertad de acción es respeto ciudadano","agrees":269,"disagrees":59,"interview":"IVO (1954) (F)","timestamp":1727835610997},"52":{"comment":"Es difícil aprobar una reforma constitucional que deja demasiados puntos en una zona gris aún reglamentándose.","agrees":214,"disagrees":142,"interview":"Anaclara (1965) (F)","timestamp":1727835732483},"53":{"comment":"La capacidad de ahorro o nivel de ingresos de las personas,  aumenta  capacidad de aportar con impuestos a  solucionar  problemas sociales.","agrees":106,"disagrees":49,"interview":"America (1949) (F)","timestamp":1727836014449},"55":{"comment":"Hay que eliminar las Afap, no tienen ningún sentido","agrees":214,"disagrees":127,"interview":"El flaco (1978) (M)","timestamp":1727838314709},"57":{"comment":"El plebiscito no resuelve problemas de déficit para el Estado (caja militar y policial) y otros sistemas corporativos (cajas profesionales)","agrees":231,"disagrees":34,"interview":"MPB (1988) (M)","timestamp":1727892503201},"59":{"comment":"Puedo escuchar una propuesta que comprenda a todos los sectores sociales para solucionar el problema.","agrees":199,"disagrees":36,"interview":"Polanyi (1976) (M)","timestamp":1727894928399},"61":{"comment":"Depende del rubro de trabajo: no es lo mismo llegar a los 60 en la construcción que como oficinista. Se tiene que pensar por sector.","agrees":279,"disagrees":69,"interview":"Mati (1991) (F)","timestamp":1727897672954},"62":{"comment":"La reforma de la seguridad recientemente aprobada castiga a los trabajadores. Se debe  consensuar una salida por todos los involucrados.","agrees":271,"disagrees":85,"interview":"Gallego (1957) (M)","timestamp":1727898707424},"64":{"comment":"Todos queremos trabajar menos y ganar más pero ya no nos morimos a los 65,como piensan pagar jubilaciones y seguro médico? Solo subiendo impuestos","agrees":131,"disagrees":182,"interview":"Cali (1978) (F)","timestamp":1727900507100},"65":{"comment":"La nueva reforma tiene que tener un componente de redistribución de la riqueza en grandes capitales muchas veces excentos de impuestos","agrees":268,"disagrees":76,"interview":"Vic (1992) (F)","timestamp":1727902000089},"66":{"comment":"Plebiscito no resuelve problemas caja militar y policial y otros sistemas (cajas profesionales). Pero ningún gobierno lo resolvió en 30 años","agrees":265,"disagrees":21,"interview":"Dante (2000) (N)","timestamp":1727902720514},"69":{"comment":"La iniciativa del plebiscito es de los más altos niveles democráticos de compromiso social y colectivo, entendiendo al asunto como de DDHH.","agrees":160,"disagrees":87,"interview":"Carlos (1980) (M)","timestamp":1727907506179},"72":{"comment":"Deberíamos encontrar una solución más consensuada entre quienes discrepamos con la reforma actual. El plebiscito no tiene ese consenso.","agrees":160,"disagrees":105,"interview":"Juli (1997) (F)","timestamp":1727911456230},"73":{"comment":"La reforma tiende a igualar las prestaciones de todas las cajas. Ademas es ley, por tanto se puede modificar en cualquier momento.","agrees":72,"disagrees":76,"interview":"Flaco (1943) (M)","timestamp":1727915313820},"74":{"comment":"Si sale el plebiscito obliga a discutir y reglamentar la seguridad social para todos, es la forma de distribuir mejor la riqueza.","agrees":176,"disagrees":127,"interview":"Parafa (1977) (M)","timestamp":1727915923349},"75":{"comment":"Estoy de acuerdo con una reforma previsional sin exoneraciones patronales - renta básica universal: por edad avanzada, por crianza, etc","agrees":182,"disagrees":71,"interview":"C (1966) (F)","timestamp":1727922457802},"76":{"comment":"Las acusaciones de inviabilidad de la reforma pueden estar basadas en supuestos económicos ortodoxos que pueden ser revisados.","agrees":172,"disagrees":102,"interview":"Mateovich (2000) (M)","timestamp":1727928006024},"78":{"comment":"Debería pensarse en un sistema de protección social, esta perspectiva es más integral y no está en el plebiscito ni en la reforma actual.","agrees":153,"disagrees":42,"interview":"Federica Peralta (1989) (F)","timestamp":1727960820040},"79":{"comment":"El plebiscito tiene problemas de implementación pero está planteado desde una perspectiva de justicia social, es un punto de partida.","agrees":214,"disagrees":101,"interview":"Federica Peralta (1989) (F)","timestamp":1727960973243},"80":{"comment":"Poner la responsabilidad de la sostenibilidad del sistema en lxs trabajadorxs solo aumenta las desigualdades. Hay que gravar capitales","agrees":236,"disagrees":100,"interview":"Federica Peralta (1989) (F)","timestamp":1727961082680},"81":{"comment":"Nada se va a solucionar si no se generan condiciones para mejorar el acceso al mercado laboral de lxs jóvenes.","agrees":212,"disagrees":34,"interview":"Federica Peralta (1989) (F)","timestamp":1727961146290},"83":{"comment":"Economistas del FA y Coalición están de acuerdo que si sale,perdemos por todos lados,esto no es contra el gobierno actual es contra el país.","agrees":105,"disagrees":126,"interview":"Marcela (1978) (F)","timestamp":1727977751304},"84":{"comment":"El aumento de la esperanza de vida no debe implicar aumentar la edad de jubilación; también aumenta la productividad y la automatización.","agrees":214,"disagrees":78,"interview":"Mateovich (2000) (M)","timestamp":1727992431086},"85":{"comment":"Hay gran desinformación sobre la seguridad social y las afap, este plebiscito también significa una oprtunidad para informar a la ciudadanía","agrees":224,"disagrees":53,"interview":"NicolásZ (1978) (M)","timestamp":1728000156469},"88":{"comment":"Las personas deben beneficiarse de los incrementos de productividad y existen diferencias de esperanza de vida según trabajos y clase","agrees":215,"disagrees":21,"interview":"Julio (1969) (M)","timestamp":1728050436100},"89":{"comment":"El tema es quien se aprieta, esta reforma al igual que la del 96 obliga a apretarse de forma exclusiva a la clase trabajadora","agrees":186,"disagrees":99,"interview":"Julio (1969) (M)","timestamp":1728050574022},"90":{"comment":"El plebiscito no soluciona todos los problemas, sientas las bases para el diálogo social que procure solucionar otros temas como en el 2008","agrees":156,"disagrees":81,"interview":"Julio (1969) (M)","timestamp":1728050926004},"93":{"comment":"la riqueza de la sociedad la construyen los trabajadoras,es injusto hacer trabajar 5 años más y encima cobrar menos,gravemos el capital.","agrees":159,"disagrees":70,"interview":"Joaquín (1955) (M)","timestamp":1728148771956},"94":{"comment":"Alguien de 65 años que cuida a nietos, hace más por la seguridad social que si trabajara para aumentar el capital de empresarios millonarios","agrees":118,"disagrees":55,"interview":"Valentina (1997) (F)","timestamp":1728216713564},"95":{"comment":"La aceleración digital está cambiando el paradigma, hay que diseñar nuevos escenarios de vida desvinculados del trabajo.","agrees":122,"disagrees":16,"interview":"Ale (1983) (M)","timestamp":1728218088238},"96":{"comment":"El sistema de seguridad social es un modelo ponzi. Debería ser OPCIONAL aportar, cada uno debería ser libre de ahorrar o invertir a su forma","agrees":47,"disagrees":82,"interview":"tuvieja (2001) (M)","timestamp":1728243310660},"97":{"comment":"Esta reforma, no es más que una medida socialista, que busca pan para hoy, y hambre para mañana.","agrees":60,"disagrees":135,"interview":"Fede (1989) (TG)","timestamp":1728248584286},"98":{"comment":"Si quienes trabajamos no ponemos un freno, pronto van a querer que nos jubilemos a los 70.","agrees":146,"disagrees":77,"interview":"Andrés (1986) (M)","timestamp":1728272383530},"99":{"comment":"La jubilación debe depender de los aportes realizados y no solamente por edad o necesidades. Quien no aportó no debe cobrar.","agrees":74,"disagrees":103,"interview":"Pitoloco (1977) (M)","timestamp":1728324030945},"100":{"comment":"El plebiscito no tiene una perspectiva de reforma de la seguridad social sino solo de una parte de la reforma jubilatoria","agrees":101,"disagrees":27,"interview":"El Pancho (1991) (M)","timestamp":1728333516791},"101":{"comment":"Se debe realizar un debate profundo; políticos, académicos y sociedad civil, cualquier ley es perfectible. Caja Militar revisarse.","agrees":192,"disagrees":24,"interview":"Adri (1961) (F)","timestamp":1728340408211},"103":{"comment":"Hay que insentivar que la clase media tengas hijos en base a políticas públicas y exoneración tributaria para dar solución a largo plazo","agrees":56,"disagrees":39,"interview":"Juan (1990) (M)","timestamp":1728406688402},"107":{"comment":"Es hora de legislar en que los aportes de los que mas ganan, sean mayores. Las jubilaciones deben beneficiar a la clase trabajadora.","agrees":88,"disagrees":30,"interview":"Jb (1965) (M)","timestamp":1728477022108},"108":{"comment":"No estoy de acuerdo con incluir estos temas en la constitución. Pero no quiero que me obliguen a afiliarte a una afap.","agrees":48,"disagrees":23,"interview":"Lorenzo (1961) (M)","timestamp":1728486919348},"113":{"comment":"Las leyes se reforman con otras leyes  No incluir cosas difíciles de modificar","agrees":77,"disagrees":36,"interview":"Juan (1950) (M)","timestamp":1728498074170},"114":{"comment":"Los impuestos no son mis enemigos, una buena administración hace uso de ellos para un bien común. Prefiero altos impuestos, altas ganancias.","agrees":64,"disagrees":31,"interview":"Ton (2003) (TG)","timestamp":1728499793892},"115":{"comment":"Asegurar una pensión o jubilación acorde a los costos de vida de este país.  Que puedan acceder a su medicación y  mejor calidad de vida.","agrees":126,"disagrees":11,"interview":"Silvia (1970) (F)","timestamp":1728500309072},"124":{"comment":"El plebiscito no toma en cuenta los cambios en el mercado laboral ni el hecho de la baja natalidad, por lo que hay menos gente aportando","agrees":53,"disagrees":54,"interview":"Tamy (1990) (N)","timestamp":1728520383950},"126":{"comment":"Creo 60 años debería ser obligatorio para todos incluso legisladores y presidente","agrees":42,"disagrees":45,"interview":"Paciencia (1958) (F)","timestamp":1728526079268},"127":{"comment":"El SI no contempla aspectos técnicos indispensables para realizar una Reforma de la Seguridad Social.","agrees":55,"disagrees":46,"interview":"Zarx (1961) (M)","timestamp":1728527311693},"132":{"comment":"la reforma no soluciono todos los problemas pero derogarla tampoco sera la solucion.","agrees":47,"disagrees":51,"interview":"Piscis 27 (1978) (F)","timestamp":1728537137156},"133":{"comment":"Hombres tienen una media de 6 años menos de esperanza de vida. Deberían jubilarse antes. Perspectiva de género urgente. Muchos mueren pronto","agrees":19,"disagrees":52,"interview":"Pisti (1992) (O)","timestamp":1728538712411},"142":{"comment":"No estoy seguro que el plebiscito sea solución, pero la últ reforma es mala, idem la que creo las Afaps. No puede lucrarse la seg social.","agrees":88,"disagrees":44,"interview":"Toto (1969) (M)","timestamp":1728542563668},"145":{"comment":"La eliminación de las AFAP significa una mejora  tanto en las jubilaciones como en la recaudación del BPS.","agrees":75,"disagrees":47,"interview":"Chete (1947) (M)","timestamp":1728564610692},"146":{"comment":"La esperanza de vida cambia segun el quintil de la población, en todo caso habría que legislar especificamente para cada sector etáreo.","agrees":39,"disagrees":46,"interview":"Juan (1959) (M)","timestamp":1728570241577},"155":{"comment":"La confiscación de los ahorros individuales por AFAP es un millon de demandas seguras al estado. Es apropiación indebida","agrees":52,"disagrees":72,"interview":"Juan (1963) (M)","timestamp":1728581241076},"157":{"comment":"Es necesario, sincerar este asunto de las jubilaciones, el sistema anterior ya no es posible con el porcentaje de activos/pasivos","agrees":67,"disagrees":41,"interview":"Doc (1969) (M)","timestamp":1728585827969},"158":{"comment":"La suba de impuestos es siempre enemigo de la prosperidad de los trabajadores","agrees":80,"disagrees":40,"interview":"Doc (1969) (M)","timestamp":1728586016620},"160":{"comment":"Aún cuando no es correcto incluirla en la Constitución, es mucho más dañina la reforma per se.","agrees":10,"disagrees":14,"interview":"Lu (1968) (F)","timestamp":1728613368118},"168":{"comment":"A veces los trabajadores empleados se ven obligados a trabajar en negro. Depender sólo de los aportes realizados desconoce esta realidad","agrees":43,"disagrees":11,"interview":"ALFREDO (1972) (M)","timestamp":1728676567807},"173":{"comment":"la reforma tiene un efecto regresivo intra y trans generacional. hay que enfocar los recursos del estado en la infancia y adolescencia.","agrees":11,"disagrees":15,"interview":"google (1995) (M)","timestamp":1728697245742},"174":{"comment":"Los partidos si tienen un programa tienen que tomar posición con respecto a un tema tan importante. No es serio dar libertad de acción.","agrees":17,"disagrees":20,"interview":"Palestina (1966) (F)","timestamp":1728707131416},"176":{"comment":"Discutir,repensar y trabajar porque todos lleguemos a una jubilación que nos garantice no morir de hambre a la vejez","agrees":50,"disagrees":4,"interview":"Irma (1965) (F)","timestamp":1728729088547},"183":{"comment":"Se deben grabar las IA porque en definitiva son mano de obra que no aporta.","agrees":19,"disagrees":9,"interview":"Ale (1964) (M)","timestamp":1728774650825},"185":{"comment":"la edad por sector es aceptable, esta reforma si se deroga creara problemas mayores al pais","agrees":17,"disagrees":18,"interview":"justicia (1958) (F)","timestamp":1728788639834},"191":{"comment":"Las AFAP hacen inversiones, por ejemplo, en cajeros automáticos para tata, con nuestra plata le sacamos trabajo a los y las trabajadoras.","agrees":25,"disagrees":14,"interview":"Cande (2006) (F)","timestamp":1728830927768},"193":{"comment":"A mi me parece lógico que las jubilaciones y pensiones no puedan ser menores que el salario mínimo,se supone q es lo mínimo para poder vivir","agrees":48,"disagrees":9,"interview":"Cande (2006) (F)","timestamp":1728831367986},"200":{"comment":"Considero que a los 60 años, cumplimos nuestro ciclo laboral. Si alguien quiere y puede seguir trabajando, también debería tener esa opción.","agrees":45,"disagrees":8,"interview":"TS (1962) (F)","timestamp":1728838386055},"201":{"comment":"La reforma 2023 mejora la situación de las personas en situación de discapacidad.  Habría que profundizar más en ese sentido","agrees":14,"disagrees":11,"interview":"Laura (1959) (F)","timestamp":1728843964093},"206":{"comment":"El costo de cualquier reforma previsional es multimillonaria. El fondo de la cuestión es, quien lo paga?","agrees":25,"disagrees":7,"interview":"Joaquim (1957) (M)","timestamp":1728876317317},"210":{"comment":"El ahorro individual debe ser administrado por el BPS, quien no podrá retener dinero por comisión. No a las Afaps","agrees":29,"disagrees":18,"interview":"Chuqui (1995) (O)","timestamp":1728903830298},"226":{"comment":"Los que ya se jubilaron de la AFAP cobran poco porque aportaron por poco tiempo. Las afap funcionan cuando ahorras por toda la vida laboral","agrees":12,"disagrees":18,"interview":"Fed (1998) (N)","timestamp":1729026018820},"227":{"comment":"El plebiscito es una mala respuesta a una pésima reforma del gobierno, por una mayoría circunstancial en el PIT-CNT.","agrees":13,"disagrees":18,"interview":"Capibara (1998) (M)","timestamp":1729026176772},"229":{"comment":"Atar la jubilación mínima al SMN, que lo define el gobierno, es contraproducente. Podemos terminar con jubilaciones y salarios sumergidos.","agrees":19,"disagrees":15,"interview":"Capibara (1998) (M)","timestamp":1729026559539},"230":{"comment":"El plebiscito consolida privilegios de algunos grupos, como por ejemplo imposibilitando revisar las inequidades de la Caja Militar.","agrees":10,"disagrees":16,"interview":"Capibara (1998) (M)","timestamp":1729026642422}},"translations":{},"overview":"Los hallazgos de la consulta pública revelan una fuerte oposición a la reforma de la Seguridad Social y al plebiscito propuesto, con preocupaciones sobre su efectividad y la necesidad de un enfoque más justo y técnico. Se enfatiza la urgencia de revisar las políticas de jubilación, sugiriendo un sistema más equitativo que considere los aportes individuales y la diversidad laboral. Además, hay un rechazo contundente hacia las AFAP, con propuestas para su eliminación y la gestión de ahorros a través del BPS, buscando mejorar las pensiones y la recaudación. En conjunto, los participantes abogan por un debate más profundo y soluciones integrales en lugar de decisiones apresuradas.","config":{"name":"Despolarizar: Plebiscito Seguridad Social","question":"Participa busca aportar a la despolarización en distintas temáticas de discusión pública.","input":"seguridad_social","model":"gpt-4o-mini","extraction":{"workers":3,"limit":100,"source_code":"import os\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\nimport concurrent.futures\n\n\ndef extraction(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n\n    model = config['extraction']['model']\n    prompt = config['extraction']['prompt']\n    workers = config['extraction']['workers']\n    limit = config['extraction']['limit']\n\n    comment_ids = (comments['comment-id'].values)[:limit]\n    comments.set_index('comment-id', inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i: i + workers]\n        batch_inputs = [comments.loc[id]['comment-body'] for id in batch]\n        batch_results = extract_batch(batch_inputs, prompt, model, workers)\n        for comment_id, extracted_args in zip(batch, batch_results):\n            for j, arg in enumerate(extracted_args):\n                new_row = {\"arg-id\": f\"A{comment_id}_{j}\",\n                           \"comment-id\": int(comment_id), \"argument\": arg}\n                results = pd.concat(\n                    [results, pd.DataFrame([new_row])], ignore_index=True)\n        update_progress(config, incr=len(batch))\n    results.to_csv(path, index=False)\n\n\ndef extract_batch(batch, prompt, model, workers):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures = [executor.submit(\n            extract_arguments, input, prompt, model) for input in list(batch)]\n        concurrent.futures.wait(futures)\n        return [future.result() for future in futures]\n\n\ndef extract_arguments(input, prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    try:\n        obj = json.loads(response)\n        # LLM sometimes returns valid JSON string\n        if isinstance(obj, str):\n            obj = [obj]\n        items = [a.strip() for a in obj]\n        items = filter(None, items)  # omit empty strings\n        return items\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying...\")\n            return extract_arguments(input, prompt, model, retries - 1)\n        else:\n            print(\"Silently giving up on trying to generate valid list.\")\n            return []\n","prompt":"/system\n\nYou are a professional research assistant and your job is to help \nme prepare a nice and clean datasets of arguments. \n\nThe context is that we have run a public consultation on the \ntopic of artificial intelligence. I'm going to give you examples \nof arguments that were contributed by the public and I want you \nto help me make them more concise and easy to read. When really \nnecessary, you can also break it down into two separate arguments, \nbut it will often be best to return a single arguments. \n\nPlease return the result as a well-formatted JSON list of strings. \n\n/human\n\nAI technologies should be developed with a focus on reducing their own \nenvironmental impact over their lifecycle.\n\n/ai \n\n[\n  \"We should focus on reducing the environmental impact of AI technologies\"\n]\n\n/human \n\nThere should be a concerted effort to educate the public about the \ncapabilities, limitations, and ethical considerations of AI.\n\n/ai \n\n[\n  \"We should educate the public about the capabilities of AI\",\n  \"We should educate the public about the limitations and ethical considerations of AI\"\n]\n\n/human \n\nAI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\n\n/ ai \n\n[\n  \"AI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\"\n]\n\n/human \n\nAI can help optimize energy grids, reducing waste and carbon emissions.\n\n/ai \n\n[\n  \"AI could optimize energy grids to reduce waste and carbon emissions.\"\n]\n\n","model":"gpt-4o-mini"},"clustering":{"clusters":3,"source_code":"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nimport pandas as pd\nimport numpy as np\nfrom importlib import import_module\n\n\ndef clustering(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    arguments_array = arguments_df[\"argument\"].values\n\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    clusters = config['clustering']['clusters']\n\n    result = cluster_embeddings(\n        docs=arguments_array,\n        embeddings=embeddings_array,\n        metadatas={\n            \"arg-id\": arguments_df[\"arg-id\"].values,\n            \"comment-id\": arguments_df[\"comment-id\"].values,\n        },\n        n_topics=clusters,\n    )\n    result.to_csv(path, index=False)\n\n\ndef cluster_embeddings(\n    docs,\n    embeddings,\n    metadatas,\n    min_cluster_size=2,\n    n_components=2,\n    n_topics=6,\n):\n    # (!) we import the following modules dynamically for a reason\n    # (they are slow to load and not required for all pipelines)\n    SpectralClustering = import_module('sklearn.cluster').SpectralClustering\n    stopwords = import_module('nltk.corpus').stopwords\n    HDBSCAN = import_module('hdbscan').HDBSCAN\n    UMAP = import_module('umap').UMAP\n    CountVectorizer = import_module(\n        'sklearn.feature_extraction.text').CountVectorizer\n    BERTopic = import_module('bertopic').BERTopic\n\n    umap_model = UMAP(\n        random_state=42,\n        n_components=n_components,\n    )\n    hdbscan_model = HDBSCAN(min_cluster_size=min_cluster_size)\n\n    stop = stopwords.words(\"english\")\n    vectorizer_model = CountVectorizer(stop_words=stop)\n    topic_model = BERTopic(\n        umap_model=umap_model,\n        hdbscan_model=hdbscan_model,\n        vectorizer_model=vectorizer_model,\n        verbose=True,\n    )\n\n    # Fit the topic model.\n    _, __ = topic_model.fit_transform(docs, embeddings=embeddings)\n\n    n_samples = len(embeddings)\n    n_neighbors = min(n_samples - 1, 10)\n    spectral_model = SpectralClustering(\n        n_clusters=n_topics,\n        affinity=\"nearest_neighbors\",\n        n_neighbors=n_neighbors,  # Use the modified n_neighbors\n        random_state=42\n    )\n    umap_embeds = umap_model.fit_transform(embeddings)\n    cluster_labels = spectral_model.fit_predict(umap_embeds)\n\n    result = topic_model.get_document_info(\n        docs=docs,\n        metadata={\n            **metadatas,\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        },\n    )\n\n    result.columns = [c.lower() for c in result.columns]\n    result = result[['arg-id', 'x', 'y', 'probability']]\n    result['cluster-id'] = cluster_labels\n\n    return result\n"},"translation":{"model":"gpt-4o-mini","languages":[],"flags":[],"source_code":"\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages\nfrom langchain.schema import AIMessage\nimport pandas as pd\nimport json\nfrom tqdm import tqdm\n\n\ndef translation(config):\n\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/translations.json\"\n    results = {}\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) == 0:\n        print(\"No languages specified. Skipping translation step.\")\n        # creating an empty file any, to reduce special casing later\n        with open(path, 'w') as file:\n            json.dump(results, file, indent=2)\n        return\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    with open(f\"outputs/{dataset}/overview.txt\") as f:\n        overview = f.read()\n\n    UI_copy = [\"Argument\", \"Original comment\", \"Representative arguments\",\n               \"Open full-screen map\", \"Back to report\", \"Hide labels\", \"Show labels\",\n               \"Show filters\", \"Hide filters\", \"Min. votes\", \"Consensus\",\n               \"Showing\", \"arguments\", \"Reset zoom\", \"Click anywhere on the map to close this\",\n               \"Click on the dot for details\",\n               \"agree\", \"disagree\", \"Language\", \"English\", \"arguments\", \"of total\",\n               \"Overview\", \"Cluster analysis\", \"Representative comments\", \"Introduction\",\n               \"Clusters\", \"Appendix\", \"This report was generated using an AI pipeline that consists of the following steps\",\n               \"Step\", \"extraction\", \"show code\", \"hide code\", \"show prompt\", \"hide prompt\", \"embedding\",\n               \"clustering\", \"labelling\", \"takeaways\", \"overview\"]\n\n    arg_list = arguments['argument'].to_list() + \\\n        labels['label'].to_list() + \\\n        UI_copy + \\\n        languages\n\n    if 'name' in config:\n        arg_list.append(config['name'])\n    if 'question' in config:\n        arg_list.append(config['question'])\n\n    prompt_file = config.get('translation_prompt', 'default')\n    with open(f\"prompts/translation/{prompt_file}.txt\") as f:\n        prompt = f.read()\n    model = config['model']\n\n    config['translation_prompt'] = prompt\n\n    translations = [translate_lang(\n        arg_list, 10, prompt, lang, model) for lang in languages]\n\n    # handling long takeaways differently, WITHOUT batching too much\n    long_arg_list = takeaways['takeaways'].to_list()\n    long_arg_list.append(overview)\n    if 'intro' in config:\n        long_arg_list.append(config['intro'])\n\n    long_translations = [translate_lang(\n        long_arg_list, 1, prompt, lang, model) for lang in languages]\n\n    for i, id in enumerate(arg_list):\n        print('i, id', i, id)\n        results[str(id)] = list([t[i] for t in translations])\n    for i, id in enumerate(long_arg_list):\n        results[str(id)] = list([t[i] for t in long_translations])\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n\n\ndef translate_lang(arg_list, batch_size, prompt, lang, model):\n    translations = []\n    lang_prompt = prompt.replace(\"{language}\", lang)\n    print(f\"Translating to {lang}...\")\n    for i in tqdm(range(0, len(arg_list), batch_size)):\n        batch = arg_list[i: i + batch_size]\n        translations.extend(translate_batch(batch, lang_prompt, model))\n    return translations\n\n\ndef translate_batch(batch, lang_prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = json.dumps(list(batch))\n    response = llm(messages=messages(lang_prompt, input)).content.strip()\n    if \"```\" in response:\n        response = response.split(\"```\")[1]\n    if response.startswith(\"json\"):\n        response = response[4:]\n    try:\n        parsed = [a.strip() for a in json.loads(response)]\n        if len(parsed) != len(batch):\n            print(\"Warning: batch size mismatch!\")\n            print(\"Batch len:\", len(batch))\n            print(\"Response len:\", len(parsed))\n            for i, item in enumerate(batch):\n                print(f\"Batch item {i}:\", item)\n                if (i \u003c len(parsed)):\n                    print(\"Response:\", parsed[i])\n            if (len(batch) \u003e 1):\n                print(\"Retrying with smaller batches...\")\n                mid = len(batch) // 2\n                return translate_batch(batch[:mid], lang_prompt, model, retries - 1) + \\\n                    translate_batch(\n                        batch[mid:], lang_prompt, model, retries - 1)\n            else:\n                print(\"Retrying batch...\")\n                return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            return parsed\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying batch...\")\n            return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            raise e\n","prompt":"/system \n\nYou are a professional translator.\nYou will receive a list of words and sentences written in Spanish or English. \nPlease return the same list, in the same order, but translated (if needed) to {language}.\nMake sure to return a valid JSON list of string of the same length as the original list."},"visualization":{"replacements":[{"replace":"Argument","by":"Argumento"},{"replace":"Original comment","by":"Comentario original"},{"replace":"Representative arguments","by":"Argumentos representativos"},{"replace":"Overview","by":"Resumen"},{"replace":"Clusters","by":"Clústeres"},{"replace":"Appendix","by":"Apéndice"},{"replace":"Introduction","by":"Introducción"},{"replace":"Step","by":"Paso"},{"replace":"Show code","by":"Mostrar código"},{"replace":"Hide code","by":"Ocultar código"},{"replace":"Show prompt","by":"Mostrar aviso"},{"replace":"Hide prompt","by":"Ocultar aviso"},{"replace":"Embedding","by":"Incrustación"},{"replace":"Clustering","by":"Agrupamiento"},{"replace":"Labelling","by":"Etiquetado"},{"replace":"Takeaways","by":"Conclusiones"},{"replace":"Overview","by":"Resumen"},{"replace":"Spanish","by":"Español"},{"replace":"English","by":"Inglés"},{"replace":"of total","by":"de total"},{"replace":"Cluster analysis","by":"Análisis de clústeres"},{"replace":"Representative comments","by":"Comentarios representativos"}],"source_code":"\nimport subprocess\n\n\ndef visualization(config):\n    output_dir = config['output_dir']\n    with open(f\"outputs/{output_dir}/result.json\") as f:\n        result = f.read()\n\n    cwd = \"../next-app\"\n    command = f\"REPORT={output_dir} npm run build\"\n\n    try:\n        process = subprocess.Popen(command, shell=True, cwd=cwd, stdout=subprocess.PIPE,\n                                   stderr=subprocess.PIPE, universal_newlines=True)\n        while True:\n            output_line = process.stdout.readline()\n            if output_line == '' and process.poll() is not None:\n                break\n            if output_line:\n                print(output_line.strip())\n        process.wait()\n        errors = process.stderr.read()\n        if errors:\n            print(\"Errors:\")\n            print(errors)\n    except subprocess.CalledProcessError as e:\n        print(\"Error: \", e)\n"},"intro":"Este reporte fue generado de forma automática (Métodos de Aprendizaje Automático, LLMs, IA) a partir de una consulta pública realizada por el equipo de ParticipaLab.","output_dir":"participa","previous":{"name":"Despolarizar: Plebiscito Seguridad Social","question":"Participa busca aportar a la despolarización en distintas temáticas de discusión pública.","input":"seguridad_social","model":"gpt-4o-mini","extraction":{"workers":3,"limit":100,"source_code":"import os\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\nimport concurrent.futures\n\n\ndef extraction(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n\n    model = config['extraction']['model']\n    prompt = config['extraction']['prompt']\n    workers = config['extraction']['workers']\n    limit = config['extraction']['limit']\n\n    comment_ids = (comments['comment-id'].values)[:limit]\n    comments.set_index('comment-id', inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i: i + workers]\n        batch_inputs = [comments.loc[id]['comment-body'] for id in batch]\n        batch_results = extract_batch(batch_inputs, prompt, model, workers)\n        for comment_id, extracted_args in zip(batch, batch_results):\n            for j, arg in enumerate(extracted_args):\n                new_row = {\"arg-id\": f\"A{comment_id}_{j}\",\n                           \"comment-id\": int(comment_id), \"argument\": arg}\n                results = pd.concat(\n                    [results, pd.DataFrame([new_row])], ignore_index=True)\n        update_progress(config, incr=len(batch))\n    results.to_csv(path, index=False)\n\n\ndef extract_batch(batch, prompt, model, workers):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures = [executor.submit(\n            extract_arguments, input, prompt, model) for input in list(batch)]\n        concurrent.futures.wait(futures)\n        return [future.result() for future in futures]\n\n\ndef extract_arguments(input, prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    try:\n        obj = json.loads(response)\n        # LLM sometimes returns valid JSON string\n        if isinstance(obj, str):\n            obj = [obj]\n        items = [a.strip() for a in obj]\n        items = filter(None, items)  # omit empty strings\n        return items\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying...\")\n            return extract_arguments(input, prompt, model, retries - 1)\n        else:\n            print(\"Silently giving up on trying to generate valid list.\")\n            return []\n","prompt":"/system\n\nYou are a professional research assistant and your job is to help \nme prepare a nice and clean datasets of arguments. \n\nThe context is that we have run a public consultation on the \ntopic of artificial intelligence. I'm going to give you examples \nof arguments that were contributed by the public and I want you \nto help me make them more concise and easy to read. When really \nnecessary, you can also break it down into two separate arguments, \nbut it will often be best to return a single arguments. \n\nPlease return the result as a well-formatted JSON list of strings. \n\n/human\n\nAI technologies should be developed with a focus on reducing their own \nenvironmental impact over their lifecycle.\n\n/ai \n\n[\n  \"We should focus on reducing the environmental impact of AI technologies\"\n]\n\n/human \n\nThere should be a concerted effort to educate the public about the \ncapabilities, limitations, and ethical considerations of AI.\n\n/ai \n\n[\n  \"We should educate the public about the capabilities of AI\",\n  \"We should educate the public about the limitations and ethical considerations of AI\"\n]\n\n/human \n\nAI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\n\n/ ai \n\n[\n  \"AI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\"\n]\n\n/human \n\nAI can help optimize energy grids, reducing waste and carbon emissions.\n\n/ai \n\n[\n  \"AI could optimize energy grids to reduce waste and carbon emissions.\"\n]\n\n","model":"gpt-4o-mini"},"clustering":{"clusters":3,"source_code":"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nimport pandas as pd\nimport numpy as np\nfrom importlib import import_module\n\n\ndef clustering(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    arguments_array = arguments_df[\"argument\"].values\n\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    clusters = config['clustering']['clusters']\n\n    result = cluster_embeddings(\n        docs=arguments_array,\n        embeddings=embeddings_array,\n        metadatas={\n            \"arg-id\": arguments_df[\"arg-id\"].values,\n            \"comment-id\": arguments_df[\"comment-id\"].values,\n        },\n        n_topics=clusters,\n    )\n    result.to_csv(path, index=False)\n\n\ndef cluster_embeddings(\n    docs,\n    embeddings,\n    metadatas,\n    min_cluster_size=2,\n    n_components=2,\n    n_topics=6,\n):\n    # (!) we import the following modules dynamically for a reason\n    # (they are slow to load and not required for all pipelines)\n    SpectralClustering = import_module('sklearn.cluster').SpectralClustering\n    stopwords = import_module('nltk.corpus').stopwords\n    HDBSCAN = import_module('hdbscan').HDBSCAN\n    UMAP = import_module('umap').UMAP\n    CountVectorizer = import_module(\n        'sklearn.feature_extraction.text').CountVectorizer\n    BERTopic = import_module('bertopic').BERTopic\n\n    umap_model = UMAP(\n        random_state=42,\n        n_components=n_components,\n    )\n    hdbscan_model = HDBSCAN(min_cluster_size=min_cluster_size)\n\n    stop = stopwords.words(\"english\")\n    vectorizer_model = CountVectorizer(stop_words=stop)\n    topic_model = BERTopic(\n        umap_model=umap_model,\n        hdbscan_model=hdbscan_model,\n        vectorizer_model=vectorizer_model,\n        verbose=True,\n    )\n\n    # Fit the topic model.\n    _, __ = topic_model.fit_transform(docs, embeddings=embeddings)\n\n    n_samples = len(embeddings)\n    n_neighbors = min(n_samples - 1, 10)\n    spectral_model = SpectralClustering(\n        n_clusters=n_topics,\n        affinity=\"nearest_neighbors\",\n        n_neighbors=n_neighbors,  # Use the modified n_neighbors\n        random_state=42\n    )\n    umap_embeds = umap_model.fit_transform(embeddings)\n    cluster_labels = spectral_model.fit_predict(umap_embeds)\n\n    result = topic_model.get_document_info(\n        docs=docs,\n        metadata={\n            **metadatas,\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        },\n    )\n\n    result.columns = [c.lower() for c in result.columns]\n    result = result[['arg-id', 'x', 'y', 'probability']]\n    result['cluster-id'] = cluster_labels\n\n    return result\n"},"translation":{"model":"gpt-4o-mini","languages":["Spanish","English"],"flags":["ES","EN"],"source_code":"\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages\nfrom langchain.schema import AIMessage\nimport pandas as pd\nimport json\nfrom tqdm import tqdm\n\n\ndef translation(config):\n\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/translations.json\"\n    results = {}\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) == 0:\n        print(\"No languages specified. Skipping translation step.\")\n        # creating an empty file any, to reduce special casing later\n        with open(path, 'w') as file:\n            json.dump(results, file, indent=2)\n        return\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    with open(f\"outputs/{dataset}/overview.txt\") as f:\n        overview = f.read()\n\n    UI_copy = [\"Argument\", \"Original comment\", \"Representative arguments\",\n               \"Open full-screen map\", \"Back to report\", \"Hide labels\", \"Show labels\",\n               \"Show filters\", \"Hide filters\", \"Min. votes\", \"Consensus\",\n               \"Showing\", \"arguments\", \"Reset zoom\", \"Click anywhere on the map to close this\",\n               \"Click on the dot for details\",\n               \"agree\", \"disagree\", \"Language\", \"English\", \"arguments\", \"of total\",\n               \"Overview\", \"Cluster analysis\", \"Representative comments\", \"Introduction\",\n               \"Clusters\", \"Appendix\", \"This report was generated using an AI pipeline that consists of the following steps\",\n               \"Step\", \"extraction\", \"show code\", \"hide code\", \"show prompt\", \"hide prompt\", \"embedding\",\n               \"clustering\", \"labelling\", \"takeaways\", \"overview\"]\n\n    arg_list = arguments['argument'].to_list() + \\\n        labels['label'].to_list() + \\\n        UI_copy + \\\n        languages\n\n    if 'name' in config:\n        arg_list.append(config['name'])\n    if 'question' in config:\n        arg_list.append(config['question'])\n\n    prompt_file = config.get('translation_prompt', 'default')\n    with open(f\"prompts/translation/{prompt_file}.txt\") as f:\n        prompt = f.read()\n    model = config['model']\n\n    config['translation_prompt'] = prompt\n\n    translations = [translate_lang(\n        arg_list, 10, prompt, lang, model) for lang in languages]\n\n    # handling long takeaways differently, WITHOUT batching too much\n    long_arg_list = takeaways['takeaways'].to_list()\n    long_arg_list.append(overview)\n    if 'intro' in config:\n        long_arg_list.append(config['intro'])\n\n    long_translations = [translate_lang(\n        long_arg_list, 1, prompt, lang, model) for lang in languages]\n\n    for i, id in enumerate(arg_list):\n        print('i, id', i, id)\n        results[str(id)] = list([t[i] for t in translations])\n    for i, id in enumerate(long_arg_list):\n        results[str(id)] = list([t[i] for t in long_translations])\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n\n\ndef translate_lang(arg_list, batch_size, prompt, lang, model):\n    translations = []\n    lang_prompt = prompt.replace(\"{language}\", lang)\n    print(f\"Translating to {lang}...\")\n    for i in tqdm(range(0, len(arg_list), batch_size)):\n        batch = arg_list[i: i + batch_size]\n        translations.extend(translate_batch(batch, lang_prompt, model))\n    return translations\n\n\ndef translate_batch(batch, lang_prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = json.dumps(list(batch))\n    response = llm(messages=messages(lang_prompt, input)).content.strip()\n    if \"```\" in response:\n        response = response.split(\"```\")[1]\n    if response.startswith(\"json\"):\n        response = response[4:]\n    try:\n        parsed = [a.strip() for a in json.loads(response)]\n        if len(parsed) != len(batch):\n            print(\"Warning: batch size mismatch!\")\n            print(\"Batch len:\", len(batch))\n            print(\"Response len:\", len(parsed))\n            for i, item in enumerate(batch):\n                print(f\"Batch item {i}:\", item)\n                if (i \u003c len(parsed)):\n                    print(\"Response:\", parsed[i])\n            if (len(batch) \u003e 1):\n                print(\"Retrying with smaller batches...\")\n                mid = len(batch) // 2\n                return translate_batch(batch[:mid], lang_prompt, model, retries - 1) + \\\n                    translate_batch(\n                        batch[mid:], lang_prompt, model, retries - 1)\n            else:\n                print(\"Retrying batch...\")\n                return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            return parsed\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying batch...\")\n            return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            raise e\n","prompt":"/system \n\nYou are a professional translator.\nYou will receive a list of words and sentences written in Spanish or English. \nPlease return the same list, in the same order, but translated (if needed) to {language}.\nMake sure to return a valid JSON list of string of the same length as the original list."},"intro":"Este reporte fue generado de forma automática (Métodos de Aprendizaje Automático, LLMs, IA) a partir de una consulta pública realizada por el equipo de ParticipaLab.","output_dir":"participa","embedding":{"source_code":"\nfrom langchain.embeddings import OpenAIEmbeddings\nimport pandas as pd\nfrom tqdm import tqdm\n\n\ndef embedding(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    embeddings = []\n    for i in tqdm(range(0, len(arguments), 1000)):\n        args = arguments[\"argument\"].tolist()[i: i + 1000]\n        embeds = OpenAIEmbeddings().embed_documents(args)\n        embeddings.extend(embeds)\n    df = pd.DataFrame(\n        [\n            {\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e}\n            for i, e in enumerate(embeddings)\n        ]\n    )\n    df.to_pickle(path)\n"},"labelling":{"sample_size":30,"source_code":"\"\"\"Create labels for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef labelling(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/labels.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['labelling']['sample_size']\n    prompt = config['labelling']['prompt']\n    model = config['labelling']['model']\n\n    question = config['question']\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n\n        args_ids_outside = clusters[clusters['cluster-id']\n                                    != cluster_id]['arg-id'].values\n        args_ids_outside = np.random.choice(args_ids_outside, size=min(\n            len(args_ids_outside), sample_size), replace=False)\n        args_sample_outside = arguments[arguments['arg-id']\n                                        .isin(args_ids_outside)]['argument'].values\n\n        label = generate_label(question, args_sample,\n                               args_sample_outside, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'label': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_label(question, args_sample, args_sample_outside, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    outside = '\\n * ' + '\\n * '.join(args_sample_outside)\n    inside = '\\n * ' + '\\n * '.join(args_sample)\n    input = f\"Question of the consultation:{question}\\n\\n\" + \\\n        f\"Examples of arguments OUTSIDE the cluster:\\n {outside}\" + \\\n        f\"Examples of arguments INSIDE the cluster:\\n {inside}\"\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are a category labeling assistant that generates a category label \nfor a set of arguments within a broader consultation. You are given the main question \nof the consultation, list of arguments inside the cluster, and a list of arguments \noutside this cluster. You answer with a single category label that summarizes the \ncluster. \n\nYou do not include context that is already obvious from the question (for example: \nif the question of the consultation is something like \"what challenges are you facing \nin France\", there is no need to repeat \"in France\" in the cluster label).\n\nThe label must be very concise and just precise enough to capture what distinguishes \nthe cluster from the arguments found outside. \n\n/human\n\nQuestion of the consultation: \"What do you think has been the impact of the UK decision to leave the EU?\"\n\nExamples of arguments OUTSIDE the cluster of interest:\n\n * We faced limitations in educational and cultural exchange opportunities due to exclusion from the Erasmus program.\n * The UK dealt with longer travel times caused by increased border checks, affecting commuters and vacationers.\n * We saw reduced cooperation in environmental standards, hindering efforts to combat climate change.\n * I experienced challenges in patient care due to disruptions in reciprocal healthcare agreements.\n * We faced complexity in residency and citizenship applications for families due to Brexit-related changes.\n * The UK witnessed hindrance in global efforts to address research challenges due to reduced collaboration opportunities.\n * We faced limitations in creative projects due to exclusion from EU cultural funding programs.\n * The UK witnessed setbacks in charitable initiatives and community support due to the loss of EU funding.\n * We experienced challenges in cross-border dispute resolution due to weakened consumer protections.\n * The UK faced limitations in touring EU countries as professional musicians, impacting careers.\n\nExamples of arguments inside the cluster:\n\n * We experienced supply chain disruptions due to Brexit, leading to increased costs and delayed deliveries for businesses.\n * I faced market fluctuations and uncertainties in investments and retirement savings because of Brexit.\n * The UK dealt with reduced profit margins as an exporter due to new tariffs and customs procedures.\n * We lost jobs because companies relocated operations to stay within the EU market post-Brexit.\n * The UK struggled with the increased cost of living caused by skyrocketing prices of imported goods.\n * We witnessed a decline in investment in the UK tech sector, impacting innovation and job opportunities.\n * The UK saw a decline in tourism due to new visa regulations, affecting hospitality businesses.\n * I experienced reduced purchasing power and increased travel expenses due to the drop in the pound's value.\n\n/ai \n\nNegative Financial Impact\n","model":"gpt-4o-mini"},"takeaways":{"sample_size":30,"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef takeaways(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/takeaways.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['takeaways']['sample_size']\n    prompt = config['takeaways']['prompt']\n    model = config['takeaways']['model']\n\n    model = config.get('model_takeaways', config.get('model', 'gpt3.5-turbo'))\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n        label = generate_takeaways(args_sample, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'takeaways': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_takeaways(args_sample, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = \"\\n\".join(args_sample)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. You will be given a list of arguments that have been made by a cluster of participants during a public consultation. You respond with one or two paragraphs summarizing your main takeaways. You are very concise and write short, snappy sentences which are easy to read. \n \n/human\n\n[\n  \"I firmly believe that gun violence constitutes a severe public health crisis in our society.\",\n  \"We need to address this issue urgently through comprehensive gun control measures.\", \n  \"I support the implementation of universal background checks for all gun buyers\",\n  \"I am in favor of banning assault weapons and high-capacity magazines.\",\n  \"I advocate for stricter regulations to prevent illegal gun trafficking.\",\n  \"Mental health evaluations should be a mandatory part of the gun purchasing process.\"\n]\n\n/ai \n\nParticipants called for comprehensive gun control, emphasizing universal background checks, assault weapon bans, curbing illegal gun trafficking, and prioritizing mental health evaluations.","model":"gpt-4o-mini"},"overview":{"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef overview(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/overview.txt\"\n\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n\n    prompt = config['overview']['prompt']\n    model = config['overview']['model']\n\n    ids = labels['cluster-id'].to_list()\n    takeaways.set_index('cluster-id', inplace=True)\n    labels.set_index('cluster-id', inplace=True)\n\n    input = ''\n    for i, id in enumerate(ids):\n        input += f\"# Cluster {i}/{len(ids)}: {labels.loc[id]['label']}\\n\\n\"\n        input += takeaways.loc[id]['takeaways'] + '\\n\\n'\n\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n\n    with open(path, 'w') as file:\n        file.write(response)\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. \nYour team has run a public consultation on a given topic and has \nstarted to analyze what the different cluster of options are. \nYou will now receive the list of clusters with a brief \nanalysis of each cluster. Your job is to return a short summary of what \nthe findings were. Your summary must be very concise (at most one \nparagraph, containing at most four sentences) and you must avoid platitudes. ","model":"gpt-4o-mini"},"aggregation":{"source_code":"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nimport json\n\n\ndef aggregation(config):\n\n    path = f\"outputs/{config['output_dir']}/result.json\"\n\n    results = {\n        \"clusters\": [],\n        \"comments\": {},\n        \"translations\": {},\n        \"overview\": \"\",\n        \"config\": config,\n    }\n\n    arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n    arguments.set_index('arg-id', inplace=True)\n\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n    useful_comment_ids = set(arguments['comment-id'].values)\n    for _, row in comments.iterrows():\n        id = row['comment-id']\n        if id in useful_comment_ids:\n            res = {'comment': row['comment-body']}\n            numeric_cols = ['agrees', 'disagrees']\n            string_cols = ['video', 'interview', 'timestamp']\n            for col in numeric_cols:\n                if col in row:\n                    res[col] = float(row[col])\n            for col in string_cols:\n                if col in row:\n                    res[col] = row[col]\n            results['comments'][str(id)] = res\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) \u003e 0:\n        with open(f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        results['translations'] = json.loads(translations)\n\n    clusters = pd.read_csv(f\"outputs/{config['output_dir']}/clusters.csv\")\n    labels = pd.read_csv(f\"outputs/{config['output_dir']}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{config['output_dir']}/takeaways.csv\")\n    takeaways.set_index('cluster-id', inplace=True)\n\n    with open(f\"outputs/{config['output_dir']}/overview.txt\") as f:\n        overview = f.read()\n    results['overview'] = overview\n\n    for _, row in labels.iterrows():\n        cid = row['cluster-id']\n        label = row['label']\n        arg_rows = clusters[clusters['cluster-id'] == cid]\n        arguments_in_cluster = []\n        for _, arg_row in arg_rows.iterrows():\n            arg_id = arg_row['arg-id']\n            argument = arguments.loc[arg_id]['argument']\n            comment_id = arguments.loc[arg_id]['comment-id']\n            x = float(arg_row['x'])\n            y = float(arg_row['y'])\n            p = float(arg_row['probability'])\n            obj = {\n                'arg_id': arg_id,\n                'argument': argument,\n                'comment_id': str(comment_id),\n                'x': x,\n                'y': y,\n                'p': p,\n            }\n            arguments_in_cluster.append(obj)\n        results['clusters'].append({\n            'cluster': label,\n            'cluster_id': str(cid),\n            'takeaways': takeaways.loc[cid]['takeaways'],\n            'arguments': arguments_in_cluster\n        })\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n"},"visualization":{"replacements":[],"source_code":"\nimport subprocess\n\n\ndef visualization(config):\n    output_dir = config['output_dir']\n    with open(f\"outputs/{output_dir}/result.json\") as f:\n        result = f.read()\n\n    cwd = \"../next-app\"\n    command = f\"REPORT={output_dir} npm run build\"\n\n    try:\n        process = subprocess.Popen(command, shell=True, cwd=cwd, stdout=subprocess.PIPE,\n                                   stderr=subprocess.PIPE, universal_newlines=True)\n        while True:\n            output_line = process.stdout.readline()\n            if output_line == '' and process.poll() is not None:\n                break\n            if output_line:\n                print(output_line.strip())\n        process.wait()\n        errors = process.stderr.read()\n        if errors:\n            print(\"Errors:\")\n            print(errors)\n    except subprocess.CalledProcessError as e:\n        print(\"Error: \", e)\n"},"plan":[{"step":"extraction","run":false,"reason":"nothing changed"},{"step":"embedding","run":false,"reason":"nothing changed"},{"step":"clustering","run":false,"reason":"nothing changed"},{"step":"labelling","run":false,"reason":"nothing changed"},{"step":"takeaways","run":false,"reason":"nothing changed"},{"step":"overview","run":false,"reason":"nothing changed"},{"step":"translation","run":true,"reason":"some parameters changed: prompt, model"},{"step":"aggregation","run":true,"reason":"some dependent steps will re-run: translation"},{"step":"visualization","run":true,"reason":"some dependent steps will re-run: aggregation"}],"status":"completed","start_time":"2024-10-21T17:48:46.474048","completed_jobs":[{"step":"translation","completed":"2024-10-21T17:50:49.834565","duration":123.358929,"params":{"model":"gpt-4o-mini","languages":["Spanish","English"],"flags":["ES","EN"],"source_code":"\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages\nfrom langchain.schema import AIMessage\nimport pandas as pd\nimport json\nfrom tqdm import tqdm\n\n\ndef translation(config):\n\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/translations.json\"\n    results = {}\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) == 0:\n        print(\"No languages specified. Skipping translation step.\")\n        # creating an empty file any, to reduce special casing later\n        with open(path, 'w') as file:\n            json.dump(results, file, indent=2)\n        return\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    with open(f\"outputs/{dataset}/overview.txt\") as f:\n        overview = f.read()\n\n    UI_copy = [\"Argument\", \"Original comment\", \"Representative arguments\",\n               \"Open full-screen map\", \"Back to report\", \"Hide labels\", \"Show labels\",\n               \"Show filters\", \"Hide filters\", \"Min. votes\", \"Consensus\",\n               \"Showing\", \"arguments\", \"Reset zoom\", \"Click anywhere on the map to close this\",\n               \"Click on the dot for details\",\n               \"agree\", \"disagree\", \"Language\", \"English\", \"arguments\", \"of total\",\n               \"Overview\", \"Cluster analysis\", \"Representative comments\", \"Introduction\",\n               \"Clusters\", \"Appendix\", \"This report was generated using an AI pipeline that consists of the following steps\",\n               \"Step\", \"extraction\", \"show code\", \"hide code\", \"show prompt\", \"hide prompt\", \"embedding\",\n               \"clustering\", \"labelling\", \"takeaways\", \"overview\"]\n\n    arg_list = arguments['argument'].to_list() + \\\n        labels['label'].to_list() + \\\n        UI_copy + \\\n        languages\n\n    if 'name' in config:\n        arg_list.append(config['name'])\n    if 'question' in config:\n        arg_list.append(config['question'])\n\n    prompt_file = config.get('translation_prompt', 'default')\n    with open(f\"prompts/translation/{prompt_file}.txt\") as f:\n        prompt = f.read()\n    model = config['model']\n\n    config['translation_prompt'] = prompt\n\n    translations = [translate_lang(\n        arg_list, 10, prompt, lang, model) for lang in languages]\n\n    # handling long takeaways differently, WITHOUT batching too much\n    long_arg_list = takeaways['takeaways'].to_list()\n    long_arg_list.append(overview)\n    if 'intro' in config:\n        long_arg_list.append(config['intro'])\n\n    long_translations = [translate_lang(\n        long_arg_list, 1, prompt, lang, model) for lang in languages]\n\n    for i, id in enumerate(arg_list):\n        print('i, id', i, id)\n        results[str(id)] = list([t[i] for t in translations])\n    for i, id in enumerate(long_arg_list):\n        results[str(id)] = list([t[i] for t in long_translations])\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n\n\ndef translate_lang(arg_list, batch_size, prompt, lang, model):\n    translations = []\n    lang_prompt = prompt.replace(\"{language}\", lang)\n    print(f\"Translating to {lang}...\")\n    for i in tqdm(range(0, len(arg_list), batch_size)):\n        batch = arg_list[i: i + batch_size]\n        translations.extend(translate_batch(batch, lang_prompt, model))\n    return translations\n\n\ndef translate_batch(batch, lang_prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = json.dumps(list(batch))\n    response = llm(messages=messages(lang_prompt, input)).content.strip()\n    if \"```\" in response:\n        response = response.split(\"```\")[1]\n    if response.startswith(\"json\"):\n        response = response[4:]\n    try:\n        parsed = [a.strip() for a in json.loads(response)]\n        if len(parsed) != len(batch):\n            print(\"Warning: batch size mismatch!\")\n            print(\"Batch len:\", len(batch))\n            print(\"Response len:\", len(parsed))\n            for i, item in enumerate(batch):\n                print(f\"Batch item {i}:\", item)\n                if (i \u003c len(parsed)):\n                    print(\"Response:\", parsed[i])\n            if (len(batch) \u003e 1):\n                print(\"Retrying with smaller batches...\")\n                mid = len(batch) // 2\n                return translate_batch(batch[:mid], lang_prompt, model, retries - 1) + \\\n                    translate_batch(\n                        batch[mid:], lang_prompt, model, retries - 1)\n            else:\n                print(\"Retrying batch...\")\n                return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            return parsed\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying batch...\")\n            return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            raise e\n","prompt":"/system \n\nYou are a professional translator.\nYou will receive a list of words and sentences written in Spanish or English. \nPlease return the same list, in the same order, but translated (if needed) to {language}.\nMake sure to return a valid JSON list of string of the same length as the original list."}},{"step":"aggregation","completed":"2024-10-21T17:50:49.858502","duration":0.023286,"params":{"source_code":"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nimport json\n\n\ndef aggregation(config):\n\n    path = f\"outputs/{config['output_dir']}/result.json\"\n\n    results = {\n        \"clusters\": [],\n        \"comments\": {},\n        \"translations\": {},\n        \"overview\": \"\",\n        \"config\": config,\n    }\n\n    arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n    arguments.set_index('arg-id', inplace=True)\n\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n    useful_comment_ids = set(arguments['comment-id'].values)\n    for _, row in comments.iterrows():\n        id = row['comment-id']\n        if id in useful_comment_ids:\n            res = {'comment': row['comment-body']}\n            numeric_cols = ['agrees', 'disagrees']\n            string_cols = ['video', 'interview', 'timestamp']\n            for col in numeric_cols:\n                if col in row:\n                    res[col] = float(row[col])\n            for col in string_cols:\n                if col in row:\n                    res[col] = row[col]\n            results['comments'][str(id)] = res\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) \u003e 0:\n        with open(f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        results['translations'] = json.loads(translations)\n\n    clusters = pd.read_csv(f\"outputs/{config['output_dir']}/clusters.csv\")\n    labels = pd.read_csv(f\"outputs/{config['output_dir']}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{config['output_dir']}/takeaways.csv\")\n    takeaways.set_index('cluster-id', inplace=True)\n\n    with open(f\"outputs/{config['output_dir']}/overview.txt\") as f:\n        overview = f.read()\n    results['overview'] = overview\n\n    for _, row in labels.iterrows():\n        cid = row['cluster-id']\n        label = row['label']\n        arg_rows = clusters[clusters['cluster-id'] == cid]\n        arguments_in_cluster = []\n        for _, arg_row in arg_rows.iterrows():\n            arg_id = arg_row['arg-id']\n            argument = arguments.loc[arg_id]['argument']\n            comment_id = arguments.loc[arg_id]['comment-id']\n            x = float(arg_row['x'])\n            y = float(arg_row['y'])\n            p = float(arg_row['probability'])\n            obj = {\n                'arg_id': arg_id,\n                'argument': argument,\n                'comment_id': str(comment_id),\n                'x': x,\n                'y': y,\n                'p': p,\n            }\n            arguments_in_cluster.append(obj)\n        results['clusters'].append({\n            'cluster': label,\n            'cluster_id': str(cid),\n            'takeaways': takeaways.loc[cid]['takeaways'],\n            'arguments': arguments_in_cluster\n        })\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n"}},{"step":"visualization","completed":"2024-10-21T17:50:54.895320","duration":5.036264,"params":{"replacements":[],"source_code":"\nimport subprocess\n\n\ndef visualization(config):\n    output_dir = config['output_dir']\n    with open(f\"outputs/{output_dir}/result.json\") as f:\n        result = f.read()\n\n    cwd = \"../next-app\"\n    command = f\"REPORT={output_dir} npm run build\"\n\n    try:\n        process = subprocess.Popen(command, shell=True, cwd=cwd, stdout=subprocess.PIPE,\n                                   stderr=subprocess.PIPE, universal_newlines=True)\n        while True:\n            output_line = process.stdout.readline()\n            if output_line == '' and process.poll() is not None:\n                break\n            if output_line:\n                print(output_line.strip())\n        process.wait()\n        errors = process.stderr.read()\n        if errors:\n            print(\"Errors:\")\n            print(errors)\n    except subprocess.CalledProcessError as e:\n        print(\"Error: \", e)\n"}}],"lock_until":"2024-10-21T17:55:54.896278","current_job":"visualization","current_job_started":"2024-10-21T17:50:49.859078","translation_prompt":"/system \n\nYou are a professional translator.\nYou will receive a list of words and sentences written in Spanish or English. \nPlease return the same list, in the same order, but translated (if needed) to {language}.\nMake sure to return a valid JSON list of string of the same length as the original list.","current_job_progress":null,"current_jop_tasks":null,"previously_completed_jobs":[{"step":"extraction","completed":"2024-10-21T17:41:06.028779","duration":39.608007,"params":{"workers":3,"limit":100,"source_code":"import os\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\nimport concurrent.futures\n\n\ndef extraction(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n\n    model = config['extraction']['model']\n    prompt = config['extraction']['prompt']\n    workers = config['extraction']['workers']\n    limit = config['extraction']['limit']\n\n    comment_ids = (comments['comment-id'].values)[:limit]\n    comments.set_index('comment-id', inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i: i + workers]\n        batch_inputs = [comments.loc[id]['comment-body'] for id in batch]\n        batch_results = extract_batch(batch_inputs, prompt, model, workers)\n        for comment_id, extracted_args in zip(batch, batch_results):\n            for j, arg in enumerate(extracted_args):\n                new_row = {\"arg-id\": f\"A{comment_id}_{j}\",\n                           \"comment-id\": int(comment_id), \"argument\": arg}\n                results = pd.concat(\n                    [results, pd.DataFrame([new_row])], ignore_index=True)\n        update_progress(config, incr=len(batch))\n    results.to_csv(path, index=False)\n\n\ndef extract_batch(batch, prompt, model, workers):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures = [executor.submit(\n            extract_arguments, input, prompt, model) for input in list(batch)]\n        concurrent.futures.wait(futures)\n        return [future.result() for future in futures]\n\n\ndef extract_arguments(input, prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    try:\n        obj = json.loads(response)\n        # LLM sometimes returns valid JSON string\n        if isinstance(obj, str):\n            obj = [obj]\n        items = [a.strip() for a in obj]\n        items = filter(None, items)  # omit empty strings\n        return items\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying...\")\n            return extract_arguments(input, prompt, model, retries - 1)\n        else:\n            print(\"Silently giving up on trying to generate valid list.\")\n            return []\n","prompt":"/system\n\nYou are a professional research assistant and your job is to help \nme prepare a nice and clean datasets of arguments. \n\nThe context is that we have run a public consultation on the \ntopic of artificial intelligence. I'm going to give you examples \nof arguments that were contributed by the public and I want you \nto help me make them more concise and easy to read. When really \nnecessary, you can also break it down into two separate arguments, \nbut it will often be best to return a single arguments. \n\nPlease return the result as a well-formatted JSON list of strings. \n\n/human\n\nAI technologies should be developed with a focus on reducing their own \nenvironmental impact over their lifecycle.\n\n/ai \n\n[\n  \"We should focus on reducing the environmental impact of AI technologies\"\n]\n\n/human \n\nThere should be a concerted effort to educate the public about the \ncapabilities, limitations, and ethical considerations of AI.\n\n/ai \n\n[\n  \"We should educate the public about the capabilities of AI\",\n  \"We should educate the public about the limitations and ethical considerations of AI\"\n]\n\n/human \n\nAI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\n\n/ ai \n\n[\n  \"AI can optimize smart homes and buildings for energy efficiency and occupant wellbeing.\"\n]\n\n/human \n\nAI can help optimize energy grids, reducing waste and carbon emissions.\n\n/ai \n\n[\n  \"AI could optimize energy grids to reduce waste and carbon emissions.\"\n]\n\n","model":"gpt-4o-mini"}},{"step":"embedding","completed":"2024-10-21T17:41:08.215217","duration":2.186174,"params":{"source_code":"\nfrom langchain.embeddings import OpenAIEmbeddings\nimport pandas as pd\nfrom tqdm import tqdm\n\n\ndef embedding(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    embeddings = []\n    for i in tqdm(range(0, len(arguments), 1000)):\n        args = arguments[\"argument\"].tolist()[i: i + 1000]\n        embeds = OpenAIEmbeddings().embed_documents(args)\n        embeddings.extend(embeds)\n    df = pd.DataFrame(\n        [\n            {\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e}\n            for i, e in enumerate(embeddings)\n        ]\n    )\n    df.to_pickle(path)\n"}},{"step":"clustering","completed":"2024-10-21T17:41:16.837330","duration":8.621473,"params":{"clusters":3,"source_code":"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nimport pandas as pd\nimport numpy as np\nfrom importlib import import_module\n\n\ndef clustering(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    arguments_array = arguments_df[\"argument\"].values\n\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    clusters = config['clustering']['clusters']\n\n    result = cluster_embeddings(\n        docs=arguments_array,\n        embeddings=embeddings_array,\n        metadatas={\n            \"arg-id\": arguments_df[\"arg-id\"].values,\n            \"comment-id\": arguments_df[\"comment-id\"].values,\n        },\n        n_topics=clusters,\n    )\n    result.to_csv(path, index=False)\n\n\ndef cluster_embeddings(\n    docs,\n    embeddings,\n    metadatas,\n    min_cluster_size=2,\n    n_components=2,\n    n_topics=6,\n):\n    # (!) we import the following modules dynamically for a reason\n    # (they are slow to load and not required for all pipelines)\n    SpectralClustering = import_module('sklearn.cluster').SpectralClustering\n    stopwords = import_module('nltk.corpus').stopwords\n    HDBSCAN = import_module('hdbscan').HDBSCAN\n    UMAP = import_module('umap').UMAP\n    CountVectorizer = import_module(\n        'sklearn.feature_extraction.text').CountVectorizer\n    BERTopic = import_module('bertopic').BERTopic\n\n    umap_model = UMAP(\n        random_state=42,\n        n_components=n_components,\n    )\n    hdbscan_model = HDBSCAN(min_cluster_size=min_cluster_size)\n\n    stop = stopwords.words(\"english\")\n    vectorizer_model = CountVectorizer(stop_words=stop)\n    topic_model = BERTopic(\n        umap_model=umap_model,\n        hdbscan_model=hdbscan_model,\n        vectorizer_model=vectorizer_model,\n        verbose=True,\n    )\n\n    # Fit the topic model.\n    _, __ = topic_model.fit_transform(docs, embeddings=embeddings)\n\n    n_samples = len(embeddings)\n    n_neighbors = min(n_samples - 1, 10)\n    spectral_model = SpectralClustering(\n        n_clusters=n_topics,\n        affinity=\"nearest_neighbors\",\n        n_neighbors=n_neighbors,  # Use the modified n_neighbors\n        random_state=42\n    )\n    umap_embeds = umap_model.fit_transform(embeddings)\n    cluster_labels = spectral_model.fit_predict(umap_embeds)\n\n    result = topic_model.get_document_info(\n        docs=docs,\n        metadata={\n            **metadatas,\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        },\n    )\n\n    result.columns = [c.lower() for c in result.columns]\n    result = result[['arg-id', 'x', 'y', 'probability']]\n    result['cluster-id'] = cluster_labels\n\n    return result\n"}},{"step":"labelling","completed":"2024-10-21T17:41:18.907908","duration":2.06956,"params":{"sample_size":30,"source_code":"\"\"\"Create labels for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef labelling(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/labels.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['labelling']['sample_size']\n    prompt = config['labelling']['prompt']\n    model = config['labelling']['model']\n\n    question = config['question']\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n\n        args_ids_outside = clusters[clusters['cluster-id']\n                                    != cluster_id]['arg-id'].values\n        args_ids_outside = np.random.choice(args_ids_outside, size=min(\n            len(args_ids_outside), sample_size), replace=False)\n        args_sample_outside = arguments[arguments['arg-id']\n                                        .isin(args_ids_outside)]['argument'].values\n\n        label = generate_label(question, args_sample,\n                               args_sample_outside, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'label': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_label(question, args_sample, args_sample_outside, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    outside = '\\n * ' + '\\n * '.join(args_sample_outside)\n    inside = '\\n * ' + '\\n * '.join(args_sample)\n    input = f\"Question of the consultation:{question}\\n\\n\" + \\\n        f\"Examples of arguments OUTSIDE the cluster:\\n {outside}\" + \\\n        f\"Examples of arguments INSIDE the cluster:\\n {inside}\"\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are a category labeling assistant that generates a category label \nfor a set of arguments within a broader consultation. You are given the main question \nof the consultation, list of arguments inside the cluster, and a list of arguments \noutside this cluster. You answer with a single category label that summarizes the \ncluster. \n\nYou do not include context that is already obvious from the question (for example: \nif the question of the consultation is something like \"what challenges are you facing \nin France\", there is no need to repeat \"in France\" in the cluster label).\n\nThe label must be very concise and just precise enough to capture what distinguishes \nthe cluster from the arguments found outside. \n\n/human\n\nQuestion of the consultation: \"What do you think has been the impact of the UK decision to leave the EU?\"\n\nExamples of arguments OUTSIDE the cluster of interest:\n\n * We faced limitations in educational and cultural exchange opportunities due to exclusion from the Erasmus program.\n * The UK dealt with longer travel times caused by increased border checks, affecting commuters and vacationers.\n * We saw reduced cooperation in environmental standards, hindering efforts to combat climate change.\n * I experienced challenges in patient care due to disruptions in reciprocal healthcare agreements.\n * We faced complexity in residency and citizenship applications for families due to Brexit-related changes.\n * The UK witnessed hindrance in global efforts to address research challenges due to reduced collaboration opportunities.\n * We faced limitations in creative projects due to exclusion from EU cultural funding programs.\n * The UK witnessed setbacks in charitable initiatives and community support due to the loss of EU funding.\n * We experienced challenges in cross-border dispute resolution due to weakened consumer protections.\n * The UK faced limitations in touring EU countries as professional musicians, impacting careers.\n\nExamples of arguments inside the cluster:\n\n * We experienced supply chain disruptions due to Brexit, leading to increased costs and delayed deliveries for businesses.\n * I faced market fluctuations and uncertainties in investments and retirement savings because of Brexit.\n * The UK dealt with reduced profit margins as an exporter due to new tariffs and customs procedures.\n * We lost jobs because companies relocated operations to stay within the EU market post-Brexit.\n * The UK struggled with the increased cost of living caused by skyrocketing prices of imported goods.\n * We witnessed a decline in investment in the UK tech sector, impacting innovation and job opportunities.\n * The UK saw a decline in tourism due to new visa regulations, affecting hospitality businesses.\n * I experienced reduced purchasing power and increased travel expenses due to the drop in the pound's value.\n\n/ai \n\nNegative Financial Impact\n","model":"gpt-4o-mini"}},{"step":"takeaways","completed":"2024-10-21T17:41:25.961485","duration":7.053021,"params":{"sample_size":30,"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef takeaways(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/takeaways.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['takeaways']['sample_size']\n    prompt = config['takeaways']['prompt']\n    model = config['takeaways']['model']\n\n    model = config.get('model_takeaways', config.get('model', 'gpt3.5-turbo'))\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n        label = generate_takeaways(args_sample, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'takeaways': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_takeaways(args_sample, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = \"\\n\".join(args_sample)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. You will be given a list of arguments that have been made by a cluster of participants during a public consultation. You respond with one or two paragraphs summarizing your main takeaways. You are very concise and write short, snappy sentences which are easy to read. \n \n/human\n\n[\n  \"I firmly believe that gun violence constitutes a severe public health crisis in our society.\",\n  \"We need to address this issue urgently through comprehensive gun control measures.\", \n  \"I support the implementation of universal background checks for all gun buyers\",\n  \"I am in favor of banning assault weapons and high-capacity magazines.\",\n  \"I advocate for stricter regulations to prevent illegal gun trafficking.\",\n  \"Mental health evaluations should be a mandatory part of the gun purchasing process.\"\n]\n\n/ai \n\nParticipants called for comprehensive gun control, emphasizing universal background checks, assault weapon bans, curbing illegal gun trafficking, and prioritizing mental health evaluations.","model":"gpt-4o-mini"}},{"step":"overview","completed":"2024-10-21T17:41:27.855130","duration":1.892998,"params":{"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef overview(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/overview.txt\"\n\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n\n    prompt = config['overview']['prompt']\n    model = config['overview']['model']\n\n    ids = labels['cluster-id'].to_list()\n    takeaways.set_index('cluster-id', inplace=True)\n    labels.set_index('cluster-id', inplace=True)\n\n    input = ''\n    for i, id in enumerate(ids):\n        input += f\"# Cluster {i}/{len(ids)}: {labels.loc[id]['label']}\\n\\n\"\n        input += takeaways.loc[id]['takeaways'] + '\\n\\n'\n\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n\n    with open(path, 'w') as file:\n        file.write(response)\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. \nYour team has run a public consultation on a given topic and has \nstarted to analyze what the different cluster of options are. \nYou will now receive the list of clusters with a brief \nanalysis of each cluster. Your job is to return a short summary of what \nthe findings were. Your summary must be very concise (at most one \nparagraph, containing at most four sentences) and you must avoid platitudes. ","model":"gpt-4o-mini"}}],"end_time":"2024-10-21T17:50:54.896273"},"embedding":{"source_code":"\nfrom langchain.embeddings import OpenAIEmbeddings\nimport pandas as pd\nfrom tqdm import tqdm\n\n\ndef embedding(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    embeddings = []\n    for i in tqdm(range(0, len(arguments), 1000)):\n        args = arguments[\"argument\"].tolist()[i: i + 1000]\n        embeds = OpenAIEmbeddings().embed_documents(args)\n        embeddings.extend(embeds)\n    df = pd.DataFrame(\n        [\n            {\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e}\n            for i, e in enumerate(embeddings)\n        ]\n    )\n    df.to_pickle(path)\n"},"labelling":{"sample_size":30,"source_code":"\"\"\"Create labels for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef labelling(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/labels.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['labelling']['sample_size']\n    prompt = config['labelling']['prompt']\n    model = config['labelling']['model']\n\n    question = config['question']\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n\n        args_ids_outside = clusters[clusters['cluster-id']\n                                    != cluster_id]['arg-id'].values\n        args_ids_outside = np.random.choice(args_ids_outside, size=min(\n            len(args_ids_outside), sample_size), replace=False)\n        args_sample_outside = arguments[arguments['arg-id']\n                                        .isin(args_ids_outside)]['argument'].values\n\n        label = generate_label(question, args_sample,\n                               args_sample_outside, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'label': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_label(question, args_sample, args_sample_outside, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    outside = '\\n * ' + '\\n * '.join(args_sample_outside)\n    inside = '\\n * ' + '\\n * '.join(args_sample)\n    input = f\"Question of the consultation:{question}\\n\\n\" + \\\n        f\"Examples of arguments OUTSIDE the cluster:\\n {outside}\" + \\\n        f\"Examples of arguments INSIDE the cluster:\\n {inside}\"\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are a category labeling assistant that generates a category label \nfor a set of arguments within a broader consultation. You are given the main question \nof the consultation, list of arguments inside the cluster, and a list of arguments \noutside this cluster. You answer with a single category label that summarizes the \ncluster. \n\nYou do not include context that is already obvious from the question (for example: \nif the question of the consultation is something like \"what challenges are you facing \nin France\", there is no need to repeat \"in France\" in the cluster label).\n\nThe label must be very concise and just precise enough to capture what distinguishes \nthe cluster from the arguments found outside. \n\n/human\n\nQuestion of the consultation: \"What do you think has been the impact of the UK decision to leave the EU?\"\n\nExamples of arguments OUTSIDE the cluster of interest:\n\n * We faced limitations in educational and cultural exchange opportunities due to exclusion from the Erasmus program.\n * The UK dealt with longer travel times caused by increased border checks, affecting commuters and vacationers.\n * We saw reduced cooperation in environmental standards, hindering efforts to combat climate change.\n * I experienced challenges in patient care due to disruptions in reciprocal healthcare agreements.\n * We faced complexity in residency and citizenship applications for families due to Brexit-related changes.\n * The UK witnessed hindrance in global efforts to address research challenges due to reduced collaboration opportunities.\n * We faced limitations in creative projects due to exclusion from EU cultural funding programs.\n * The UK witnessed setbacks in charitable initiatives and community support due to the loss of EU funding.\n * We experienced challenges in cross-border dispute resolution due to weakened consumer protections.\n * The UK faced limitations in touring EU countries as professional musicians, impacting careers.\n\nExamples of arguments inside the cluster:\n\n * We experienced supply chain disruptions due to Brexit, leading to increased costs and delayed deliveries for businesses.\n * I faced market fluctuations and uncertainties in investments and retirement savings because of Brexit.\n * The UK dealt with reduced profit margins as an exporter due to new tariffs and customs procedures.\n * We lost jobs because companies relocated operations to stay within the EU market post-Brexit.\n * The UK struggled with the increased cost of living caused by skyrocketing prices of imported goods.\n * We witnessed a decline in investment in the UK tech sector, impacting innovation and job opportunities.\n * The UK saw a decline in tourism due to new visa regulations, affecting hospitality businesses.\n * I experienced reduced purchasing power and increased travel expenses due to the drop in the pound's value.\n\n/ai \n\nNegative Financial Impact\n","model":"gpt-4o-mini"},"takeaways":{"sample_size":30,"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef takeaways(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/takeaways.csv\"\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    clusters = pd.read_csv(f\"outputs/{dataset}/clusters.csv\")\n\n    results = pd.DataFrame()\n\n    sample_size = config['takeaways']['sample_size']\n    prompt = config['takeaways']['prompt']\n    model = config['takeaways']['model']\n\n    model = config.get('model_takeaways', config.get('model', 'gpt3.5-turbo'))\n    cluster_ids = clusters['cluster-id'].unique()\n\n    update_progress(config, total=len(cluster_ids))\n\n    for _, cluster_id in tqdm(enumerate(cluster_ids), total=len(cluster_ids)):\n        args_ids = clusters[clusters['cluster-id']\n                            == cluster_id]['arg-id'].values\n        args_ids = np.random.choice(args_ids, size=min(\n            len(args_ids), sample_size), replace=False)\n        args_sample = arguments[arguments['arg-id']\n                                .isin(args_ids)]['argument'].values\n        label = generate_takeaways(args_sample, prompt, model)\n        results = pd.concat([results, pd.DataFrame(\n            [{'cluster-id': cluster_id, 'takeaways': label}])], ignore_index=True)\n        update_progress(config, incr=1)\n\n    results.to_csv(path, index=False)\n\n\ndef generate_takeaways(args_sample, prompt, model):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = \"\\n\".join(args_sample)\n    response = llm(messages=messages(prompt, input)).content.strip()\n    return response\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. You will be given a list of arguments that have been made by a cluster of participants during a public consultation. You respond with one or two paragraphs summarizing your main takeaways. You are very concise and write short, snappy sentences which are easy to read. \n \n/human\n\n[\n  \"I firmly believe that gun violence constitutes a severe public health crisis in our society.\",\n  \"We need to address this issue urgently through comprehensive gun control measures.\", \n  \"I support the implementation of universal background checks for all gun buyers\",\n  \"I am in favor of banning assault weapons and high-capacity magazines.\",\n  \"I advocate for stricter regulations to prevent illegal gun trafficking.\",\n  \"Mental health evaluations should be a mandatory part of the gun purchasing process.\"\n]\n\n/ai \n\nParticipants called for comprehensive gun control, emphasizing universal background checks, assault weapon bans, curbing illegal gun trafficking, and prioritizing mental health evaluations.","model":"gpt-4o-mini"},"overview":{"source_code":"\"\"\"Create summaries for the clusters.\"\"\"\n\nfrom tqdm import tqdm\nimport os\nfrom typing import List\nimport numpy as np\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages, update_progress\n\n\ndef overview(config):\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/overview.txt\"\n\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n\n    prompt = config['overview']['prompt']\n    model = config['overview']['model']\n\n    ids = labels['cluster-id'].to_list()\n    takeaways.set_index('cluster-id', inplace=True)\n    labels.set_index('cluster-id', inplace=True)\n\n    input = ''\n    for i, id in enumerate(ids):\n        input += f\"# Cluster {i}/{len(ids)}: {labels.loc[id]['label']}\\n\\n\"\n        input += takeaways.loc[id]['takeaways'] + '\\n\\n'\n\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    response = llm(messages=messages(prompt, input)).content.strip()\n\n    with open(path, 'w') as file:\n        file.write(response)\n","prompt":"/system \n\nYou are an expert research assistant working in a think tank. \nYour team has run a public consultation on a given topic and has \nstarted to analyze what the different cluster of options are. \nYou will now receive the list of clusters with a brief \nanalysis of each cluster. Your job is to return a short summary of what \nthe findings were. Your summary must be very concise (at most one \nparagraph, containing at most four sentences) and you must avoid platitudes. ","model":"gpt-4o-mini"},"aggregation":{"source_code":"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nfrom tqdm import tqdm\nfrom typing import List\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nimport json\n\n\ndef aggregation(config):\n\n    path = f\"outputs/{config['output_dir']}/result.json\"\n\n    results = {\n        \"clusters\": [],\n        \"comments\": {},\n        \"translations\": {},\n        \"overview\": \"\",\n        \"config\": config,\n    }\n\n    arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n    arguments.set_index('arg-id', inplace=True)\n\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n    useful_comment_ids = set(arguments['comment-id'].values)\n    for _, row in comments.iterrows():\n        id = row['comment-id']\n        if id in useful_comment_ids:\n            res = {'comment': row['comment-body']}\n            numeric_cols = ['agrees', 'disagrees']\n            string_cols = ['video', 'interview', 'timestamp']\n            for col in numeric_cols:\n                if col in row:\n                    res[col] = float(row[col])\n            for col in string_cols:\n                if col in row:\n                    res[col] = row[col]\n            results['comments'][str(id)] = res\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) \u003e 0:\n        with open(f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        results['translations'] = json.loads(translations)\n\n    clusters = pd.read_csv(f\"outputs/{config['output_dir']}/clusters.csv\")\n    labels = pd.read_csv(f\"outputs/{config['output_dir']}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{config['output_dir']}/takeaways.csv\")\n    takeaways.set_index('cluster-id', inplace=True)\n\n    with open(f\"outputs/{config['output_dir']}/overview.txt\") as f:\n        overview = f.read()\n    results['overview'] = overview\n\n    for _, row in labels.iterrows():\n        cid = row['cluster-id']\n        label = row['label']\n        arg_rows = clusters[clusters['cluster-id'] == cid]\n        arguments_in_cluster = []\n        for _, arg_row in arg_rows.iterrows():\n            arg_id = arg_row['arg-id']\n            argument = arguments.loc[arg_id]['argument']\n            comment_id = arguments.loc[arg_id]['comment-id']\n            x = float(arg_row['x'])\n            y = float(arg_row['y'])\n            p = float(arg_row['probability'])\n            obj = {\n                'arg_id': arg_id,\n                'argument': argument,\n                'comment_id': str(comment_id),\n                'x': x,\n                'y': y,\n                'p': p,\n            }\n            arguments_in_cluster.append(obj)\n        results['clusters'].append({\n            'cluster': label,\n            'cluster_id': str(cid),\n            'takeaways': takeaways.loc[cid]['takeaways'],\n            'arguments': arguments_in_cluster\n        })\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n"},"plan":[{"step":"extraction","run":false,"reason":"nothing changed"},{"step":"embedding","run":false,"reason":"nothing changed"},{"step":"clustering","run":false,"reason":"nothing changed"},{"step":"labelling","run":false,"reason":"nothing changed"},{"step":"takeaways","run":false,"reason":"nothing changed"},{"step":"overview","run":false,"reason":"nothing changed"},{"step":"translation","run":true,"reason":"some parameters changed: languages"},{"step":"aggregation","run":true,"reason":"some dependent steps will re-run: translation"},{"step":"visualization","run":true,"reason":"some dependent steps will re-run: aggregation"}],"status":"running","start_time":"2024-10-21T17:55:24.738459","completed_jobs":[{"step":"translation","completed":"2024-10-21T17:55:24.743337","duration":0.001861,"params":{"model":"gpt-4o-mini","languages":[],"flags":[],"source_code":"\nimport json\nfrom tqdm import tqdm\nimport pandas as pd\nfrom langchain.chat_models import ChatOpenAI\nfrom utils import messages\nfrom langchain.schema import AIMessage\nimport pandas as pd\nimport json\nfrom tqdm import tqdm\n\n\ndef translation(config):\n\n    dataset = config['output_dir']\n    path = f\"outputs/{dataset}/translations.json\"\n    results = {}\n\n    languages = list(config.get('translation', {}).get('languages', []))\n    if len(languages) == 0:\n        print(\"No languages specified. Skipping translation step.\")\n        # creating an empty file any, to reduce special casing later\n        with open(path, 'w') as file:\n            json.dump(results, file, indent=2)\n        return\n\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\")\n    labels = pd.read_csv(f\"outputs/{dataset}/labels.csv\")\n    takeaways = pd.read_csv(f\"outputs/{dataset}/takeaways.csv\")\n    with open(f\"outputs/{dataset}/overview.txt\") as f:\n        overview = f.read()\n\n    UI_copy = [\"Argument\", \"Original comment\", \"Representative arguments\",\n               \"Open full-screen map\", \"Back to report\", \"Hide labels\", \"Show labels\",\n               \"Show filters\", \"Hide filters\", \"Min. votes\", \"Consensus\",\n               \"Showing\", \"arguments\", \"Reset zoom\", \"Click anywhere on the map to close this\",\n               \"Click on the dot for details\",\n               \"agree\", \"disagree\", \"Language\", \"English\", \"arguments\", \"of total\",\n               \"Overview\", \"Cluster analysis\", \"Representative comments\", \"Introduction\",\n               \"Clusters\", \"Appendix\", \"This report was generated using an AI pipeline that consists of the following steps\",\n               \"Step\", \"extraction\", \"show code\", \"hide code\", \"show prompt\", \"hide prompt\", \"embedding\",\n               \"clustering\", \"labelling\", \"takeaways\", \"overview\"]\n\n    arg_list = arguments['argument'].to_list() + \\\n        labels['label'].to_list() + \\\n        UI_copy + \\\n        languages\n\n    if 'name' in config:\n        arg_list.append(config['name'])\n    if 'question' in config:\n        arg_list.append(config['question'])\n\n    prompt_file = config.get('translation_prompt', 'default')\n    with open(f\"prompts/translation/{prompt_file}.txt\") as f:\n        prompt = f.read()\n    model = config['model']\n\n    config['translation_prompt'] = prompt\n\n    translations = [translate_lang(\n        arg_list, 10, prompt, lang, model) for lang in languages]\n\n    # handling long takeaways differently, WITHOUT batching too much\n    long_arg_list = takeaways['takeaways'].to_list()\n    long_arg_list.append(overview)\n    if 'intro' in config:\n        long_arg_list.append(config['intro'])\n\n    long_translations = [translate_lang(\n        long_arg_list, 1, prompt, lang, model) for lang in languages]\n\n    for i, id in enumerate(arg_list):\n        print('i, id', i, id)\n        results[str(id)] = list([t[i] for t in translations])\n    for i, id in enumerate(long_arg_list):\n        results[str(id)] = list([t[i] for t in long_translations])\n\n    with open(path, 'w') as file:\n        json.dump(results, file, indent=2)\n\n\ndef translate_lang(arg_list, batch_size, prompt, lang, model):\n    translations = []\n    lang_prompt = prompt.replace(\"{language}\", lang)\n    print(f\"Translating to {lang}...\")\n    for i in tqdm(range(0, len(arg_list), batch_size)):\n        batch = arg_list[i: i + batch_size]\n        translations.extend(translate_batch(batch, lang_prompt, model))\n    return translations\n\n\ndef translate_batch(batch, lang_prompt, model, retries=3):\n    llm = ChatOpenAI(model_name=model, temperature=0.0)\n    input = json.dumps(list(batch))\n    response = llm(messages=messages(lang_prompt, input)).content.strip()\n    if \"```\" in response:\n        response = response.split(\"```\")[1]\n    if response.startswith(\"json\"):\n        response = response[4:]\n    try:\n        parsed = [a.strip() for a in json.loads(response)]\n        if len(parsed) != len(batch):\n            print(\"Warning: batch size mismatch!\")\n            print(\"Batch len:\", len(batch))\n            print(\"Response len:\", len(parsed))\n            for i, item in enumerate(batch):\n                print(f\"Batch item {i}:\", item)\n                if (i \u003c len(parsed)):\n                    print(\"Response:\", parsed[i])\n            if (len(batch) \u003e 1):\n                print(\"Retrying with smaller batches...\")\n                mid = len(batch) // 2\n                return translate_batch(batch[:mid], lang_prompt, model, retries - 1) + \\\n                    translate_batch(\n                        batch[mid:], lang_prompt, model, retries - 1)\n            else:\n                print(\"Retrying batch...\")\n                return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            return parsed\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Response was:\", response)\n        if retries \u003e 0:\n            print(\"Retrying batch...\")\n            return translate_batch(batch, lang_prompt, model, retries - 1)\n        else:\n            raise e\n","prompt":"/system \n\nYou are a professional translator.\nYou will receive a list of words and sentences written in Spanish or English. \nPlease return the same list, in the same order, but translated (if needed) to {language}.\nMake sure to return a valid JSON list of string of the same length as the original list."}}],"lock_until":"2024-10-21T18:00:24.744563","current_job":"aggregation","current_job_started":"2024-10-21T17:55:24.744555","current_job_progress":null,"current_jop_tasks":null}}},"__N_SSG":true},"page":"/","query":{},"buildId":"JlzSBEfWXFpqht8WQyym9","assetPrefix":".","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>